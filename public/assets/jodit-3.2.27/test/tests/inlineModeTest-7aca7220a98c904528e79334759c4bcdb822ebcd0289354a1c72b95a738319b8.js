describe("Test Inline mode",function(){describe("init with inline option",function(){describe("For TEXTAREA",function(){it("Should hide textarea like standart mode",function(){var e=appendTestArea(),t=new Jodit(e,{inline:!0});expect(t.container).to.be.not.equal(e),expect(t.container.classList.contains("jodit_inline")).to.be["true"],expect(t.container.nextSibling).to.be.equal(e),expect(e.style.display).to.be.equal("none"),expect(e.value).to.be.equal(t.value)})}),describe("For DIV",function(){it("Should use this element like container",function(){var e=appendTestDiv(),t="<p>HTML</p>";e.innerHTML=t;var o=new Jodit(e,{inline:!0,observer:{timeout:0}});expect(o.container).to.be.equal(e),expect(o.container.classList.contains("jodit_inline")).to.be["true"],expect(o.container.querySelector(".jodit_workplace")).to.be.not.equal(null),expect(o.container.querySelector(".jodit_wysiwyg")).to.be.not.equal(null),expect(o.ownerWindow.getComputedStyle(e).display).to.be.equal("block"),expect(t).to.be.equal(o.value)})}),describe("For H1",function(){it("Should use this element like container",function(){var e=document.createElement("h1"),t="HTML";e.innerHTML=t,box.appendChild(e);var o=new Jodit(e,{inline:!0,observer:{timeout:0}});expect(o.container).to.be.equal(e),expect(o.container.classList.contains("jodit_inline")).to.be["true"],expect(o.container.querySelector(".jodit_workplace")).to.be.not.equal(null),expect(o.container.querySelector(".jodit_wysiwyg")).to.be.not.equal(null),expect(o.ownerWindow.getComputedStyle(e).display).to.be.equal("block"),expect(t).to.be.equal(o.value),e.parentNode.removeChild(e)})})}),describe("Destruct Jodit",function(){describe("For TEXTAREA",function(){it("Should show textarea like standart mode",function(){var e=appendTestArea();new Jodit(e,{inline:!0}).destruct(),expect(e.style.display).to.be.not.equal("none")})}),describe("For DIV",function(){it("Should remove all extra classes and remove all extra elements",function(){var e=appendTestDiv(),t="<p>HTML</p>";e.style.display="block",e.innerHTML=t;var o=new Jodit(e,{inline:!0,observer:{timeout:0}});o.destruct(),expect(o.ownerWindow.getComputedStyle(e).display).to.be.equal("block"),expect(e.innerHTML).to.be.equal(t),expect(e.className.toString()).to.be.equal("")})})}),describe("Inline popups",function(){describe("Click on Image",function(){it("Should show inline popup",function(){var e=new Jodit(appendTestDiv());e.value="<p>test <img/> test</p>";var t=e.editor.querySelector("img");simulateEvent("mousedown",0,t);var o=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(o).to.be.not.equal(null)}),describe("Disable toolbarInline = false",function(){it("Should show inline popup",function(){var e=new Jodit(appendTestDiv(),{toolbarInline:!1});e.value="<p>test <img/> test</p>";var t=e.editor.querySelector("img");simulateEvent("mousedown",0,t);var o=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(o).to.be.equal(null)})}),describe("Click in the right side of editor",function(){it("Should open inline-popup with float by right editor side",function(){box.style.width="auto";var e=new Jodit(appendTestArea(),{disablePlugins:"mobile"});e.value='<p>test <img style="width: 30px; float: right"/> test</p>',simulateEvent("mousedown",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(t).to.be.not["null"];var o=offset(t),i=offset(e.container);expect(Math.abs(o.left+o.width-(i.left+i.width))<2).to.be["true"]}),describe("Click in the right side of editor in window with scroll",function(){it("Should open inline-popup with float by right editor side",function(){box.style.width="auto";var e,t,o=[];for(e=0;e<100;e+=1)t=document.createElement("br"),document.body.appendChild(t),o.push(t);var i=new Jodit(appendTestArea(),{disablePlugins:"mobile"});i.value='<p>test <img style="width: 30px; float: right"/> test</p>',simulateEvent("mousedown",0,i.editor.querySelector("img"));var n=i.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+i.id+"]");expect(n).to.be.not["null"];var r=offset(n),l=offset(i.container);expect(Math.abs(r.left+r.width-(l.left+l.width))<2).to.be["true"],o.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)})})})}),describe("Recalk position after Scroll",function(){it("Should reacalc inline popup position",function(){var e=new Jodit(appendTestArea(),{height:500});e.value="<p>test"+"<br>".repeat(20)+' <img style="width:100px;height:100px;" src="tests/artio.jpg"/> '+"<br>".repeat(20)+"test</p>";var t=e.editor.querySelector("img");t.scrollIntoView(),simulateEvent("mousedown",0,t);var o=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(o).to.be.not["null"];var i=offset(t),n=offset(o);expect(Math.abs(n.top-(i.top+i.height)-10)<2).to.be["true"],e.editor.scrollTop=e.editor.scrollTop+50,simulateEvent("scroll",0,e.editor),i=offset(t),n=offset(o),expect(Math.abs(n.top-(i.top+i.height)-10)<2).to.be["true"]})}),describe("Popup position ouside of editor",function(){it("Should hide inline popup",function(){var e=new Jodit(appendTestArea(),{height:500});e.value="<p>test"+"<br>".repeat(20)+' <img style="width:100px;height:100px;" src="tests/artio.jpg"/> '+"<br>".repeat(120)+"test</p>";var t=e.editor.querySelector("img");t.scrollIntoView(),simulateEvent("mousedown",0,t);var o=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(o).to.be.not["null"];var i=offset(t),n=offset(o);expect(Math.abs(n.top-(i.top+i.height)-10)<2).to.be["true"],e.editor.scrollTop=e.editor.scrollTop+1e3,simulateEvent("scroll",0,e.editor),expect(o.parentNode.classList.contains("jodit_toolbar_popup-inline-target-hidden")).to.be["true"],t.scrollIntoView(),simulateEvent("scroll",0,e.editor),expect(o.parentNode.classList.contains("jodit_toolbar_popup-inline-target-hidden")).to.be["false"]})})}),describe("Click on Image",function(){describe("On mobile",function(){it("Should show inline popup",function(){var e=new Jodit(appendTestDiv());e.value="<p>test <img/> test</p>";var t=e.editor.querySelector("img");simulateEvent("touchstart",0,t);var o=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(o).to.be.not.equal(null)})})}),describe("Click on link",function(){it("Should show inline popup",function(){var e=new Jodit(appendTestDiv());e.value='<p>test <a href="#test">test</a> test</p>';var t=e.editor.querySelector("a");simulateEvent("mousedown",0,t);var o=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(o).to.be.not.equal(null)}),describe("Disable with toolbarInlineDisableFor",function(){describe("Option like string",function(){it("Should now show inline popup for link",function(){var e=new Jodit(appendTestDiv(),{toolbarInline:!0,toolbarInlineDisableFor:"a,IMG"});e.value='<table><tr><td>1</td></tr></table><p>test <a href="#test">test</a> <img style="width:30px" src="tests/artio.jpg">> test</p>';var t=e.editor.querySelector("a"),o=e.editor.querySelector("img"),i=e.editor.querySelector("td");simulateEvent("mousedown",0,t);var n=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(n).to.be.equal(null),simulateEvent("mousedown",0,o),n=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]"),expect(n).to.be.equal(null),simulateEvent("mousedown",0,i),n=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]"),expect(n).to.be.not.equal(null)})}),describe("Option like srray",function(){it("Should now show inline popup for link",function(){var e=new Jodit(appendTestDiv(),{toolbarInline:!0,toolbarInlineDisableFor:["A","table"]});e.value='<table><tr><td>1</td></tr></table><p>test <a href="#test">test</a> <img style="width:30px" src="tests/artio.jpg">> test</p>';var t=e.editor.querySelector("a"),o=e.editor.querySelector("img"),i=e.editor.querySelector("td");simulateEvent("mousedown",0,t);var n=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(n).to.be.equal(null),simulateEvent("mousedown",0,o),n=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]"),expect(n).to.be.not.equal(null),simulateEvent("mousedown",0,i),n=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]"),expect(n).to.be.equal(null)})})})}),describe("Click on table cell",function(){it("Should show inline popup",function(){var e=new Jodit(appendTestDiv());e.value="<table><tr><td>test test</a> test</td></tr></table>";var t=e.editor.querySelector("td");simulateEvent("mousedown",0,t);var o=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(o).to.be.not.equal(null)})}),describe("Selection some text inside the editor",function(){it("Should show inline popup",function(){var e=new Jodit(appendTestDiv(),{preset:"inline"});e.value="test<br>test",e.selection.select(e.editor.firstChild),simulateEvent("selectionchange",0,e.editor);var t=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(t).to.be.not.equal(null)}),describe("In readonly mode",function(){it("Should not show inline popup",function(){var e=new Jodit(appendTestDiv(),{preset:"inline",readonly:!0});e.value="test<br>test",e.selection.select(e.editor.firstChild),simulateEvent("selectionchange",0,e.editor);var t=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(t).to.be["null"]}),describe("After disable readonly mode",function(){it("Should show inline popup",function(){var e=new Jodit(appendTestDiv(),{preset:"inline",readonly:!0});e.value="test<br>test",e.selection.select(e.editor.firstChild),simulateEvent("selectionchange",0,e.editor);var t=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(t).to.be["null"],e.setReadOnly(!1),e.selection.select(e.editor.firstChild),simulateEvent("selectionchange",0,e.editor),t=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]"),expect(t).to.be.not["null"],expect(e.ownerWindow.getComputedStyle(t).display).to.be.equal("inline-block")})})}),describe("After then selection was collapsed",function(){it("Should hide inline popup",function(){var e=new Jodit(appendTestDiv(),{preset:"inline"});e.value="test<br>test",e.selection.select(e.editor.firstChild),simulateEvent("selectionchange",0,e.editor);var t=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(t).to.be.not["null"];var o=e.editorDocument.createRange();o.setStart(e.editor.firstChild,0),o.collapse(!0),e.selection.selectRange(o),simulateEvent("mousedown",0,e.editor),expect(t.parentNode).to.be["null"]})}),describe("Select some text in one editor and after this select focus in another",function(){it("Should hide inline popup in first",function(){var e=new Jodit(appendTestDiv(),{preset:"inline",observer:{timeout:0}}),t=new Jodit(appendTestDiv(),{preset:"inline",observer:{timeout:0}});e.value="test<br>test",t.value="test<br>test",e.selection.select(e.editor.firstChild),simulateEvent("mousedown",0,e.editor),simulateEvent("mouseup",0,e.editor);var o=e.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+e.id+"]");expect(o).to.be.not["null"],expect(o.parentNode).to.be.not["null"];var i=t.editorDocument.createRange();i.setStart(t.editor.firstChild,0),i.collapse(!0),t.selection.selectRange(i),simulateEvent("mousedown",0,t.ownerWindow),expect(o.parentNode).to.be["null"]})})})}),describe("In iframe mode",function(){describe("Inline popups",function(){describe("Click on Image",function(){it("Should show inline popup",function(e){unmocPromise();new Jodit(appendTestDiv(),{iframe:!0,events:{afterConstructor:function(t){t.value="<p>test <img/> test</p>";var o=t.editor.querySelector("img");simulateEvent("mousedown",0,o);var i=t.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+t.id+"]");expect(i).to.be.not.equal(null),e()}}})}),describe("Disable toolbarInline = false",function(){it("Should show inline popup",function(e){unmocPromise();new Jodit(appendTestDiv(),{toolbarInline:!1,iframe:!0,events:{afterConstructor:function(t){t.value="<p>test <img/> test</p>";var o=t.editor.querySelector("img");simulateEvent("mousedown",0,o);var i=t.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+t.id+"]");expect(i).to.be.equal(null),e()}}})})})}),describe("Click on Image",function(){describe("On mobile",function(){it("Should show inline popup",function(e){unmocPromise();new Jodit(appendTestDiv(),{iframe:!0,events:{afterConstructor:function(t){t.value="<p>test <img/> test</p>";var o=t.editor.querySelector("img");simulateEvent("touchstart",0,o);var i=t.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+t.id+"]");expect(i).to.be.not.equal(null),e()}}})})})}),describe("Click on link",function(){it("Should show inline popup",function(e){unmocPromise();new Jodit(appendTestDiv(),{iframe:!0,events:{afterConstructor:function(t){t.value='<p>test <a href="#test">test</a> test</p>';var o=t.editor.querySelector("a");simulateEvent("mousedown",0,o);var i=t.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+t.id+"]");expect(i).to.be.not.equal(null),e()}}})}),describe("Disable with toolbarInlineDisableFor",function(){describe("Option like string",function(){it("Should now show inline popup for link",function(e){unmocPromise();new Jodit(appendTestDiv(),{iframe:!0,toolbarInline:!0,toolbarInlineDisableFor:"a,IMG",events:{afterConstructor:function(t){t.value='<table><tr><td>1</td></tr></table><p>test <a href="#test">test</a> <img style="width:30px" src="tests/artio.jpg">> test</p>';var o=t.editor.querySelector("a"),i=t.editor.querySelector("img"),n=t.editor.querySelector("td");simulateEvent("mousedown",0,o);var r=t.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+t.id+"]");expect(r).to.be.equal(null),simulateEvent("mousedown",0,i),r=t.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+t.id+"]"),expect(r).to.be.equal(null),simulateEvent("mousedown",0,n),r=t.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+t.id+"]"),expect(r).to.be.not.equal(null),e()}}})})}),describe("Option like srray",function(){it("Should now show inline popup for link",function(e){unmocPromise();new Jodit(appendTestDiv(),{iframe:!0,toolbarInline:!0,toolbarInlineDisableFor:["A","table"],events:{afterConstructor:function(t){t.value='<table><tr><td>1</td></tr></table><p>test <a href="#test">test</a> <img style="width:30px" src="tests/artio.jpg">> test</p>';var o=t.editor.querySelector("a"),i=t.editor.querySelector("img"),n=t.editor.querySelector("td");simulateEvent("mousedown",0,o);var r=t.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+t.id+"]");expect(r).to.be.equal(null),simulateEvent("mousedown",0,i),r=t.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+t.id+"]"),expect(r).to.be.not.equal(null),simulateEvent("mousedown",0,n),r=t.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+t.id+"]"),expect(r).to.be.equal(null),e()}}})})})})}),describe("Click on table cell",function(){it("Should show inline popup",function(e){unmocPromise();new Jodit(appendTestDiv(),{iframe:!0,events:{afterConstructor:function(t){t.value="<table><tr><td>test test</a> test</td></tr></table>";var o=t.editor.querySelector("td");simulateEvent("mousedown",0,o);var i=t.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+t.id+"]");expect(i).to.be.not.equal(null),e()}}})})}),describe("Selection some text inside the editor",function(){it("Should show inline popup",function(e){unmocPromise();new Jodit(appendTestDiv(),{preset:"inline",iframe:!0,events:{afterConstructor:function(t){t.value="test<br>test",t.selection.select(t.editor.firstChild),simulateEvent("selectionchange",0,t.editor);var o=t.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id="+t.id+"]");expect(o).to.be.not.equal(null),e()}}})})})})}),afterEach(removeStuff)});