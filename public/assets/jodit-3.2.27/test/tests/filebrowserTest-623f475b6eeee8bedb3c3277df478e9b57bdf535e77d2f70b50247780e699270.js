describe("Jodit FileBrowser Tests",function(){describe("Constructor/Destructor",function(){describe("Without Jodit",function(){it("Should create dialog and load files",function(){var e=new Jodit.modules.FileBrowser(null,{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}});e.open(function(){}),expect(document.querySelectorAll(".jodit_dialog_box.active").length).to.be.equal(1),e.close(),expect(document.querySelectorAll(".jodit_dialog_box.active").length).to.be.equal(0)})}),it("Should create dialog and load files",function(){var e=new Jodit(appendTestArea(),{filebrowser:{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}}});new Jodit.modules.FileBrowser(e).open(function(){}),expect(e.ownerDocument.querySelectorAll(".jodit_dialog_box.active[data-editor_id="+e.id+"]").length).to.be.equal(1)}),it("Should add filebrowser icon in image buttons popup",function(){var e=new Jodit(appendTestArea(),{filebrowser:{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}}});simulateEvent("mousedown",0,e.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-image")),expect(e.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-image .jodit_tabs_buttons .active").innerText).to.equal("Browse")}),it("Should add uploader icon in image buttons popup",function(){var e=new Jodit(appendTestArea(),{uploader:{url:"https://xdsoft.net/jodit/connector/index.php?action=upload"},filebrowser:{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}}});simulateEvent("mousedown",0,e.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-image")),expect(e.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-image .jodit_tabs_buttons .active").innerText).to.equal("Upload")})}),describe("Toolbar",function(){describe("Without Jodit",function(){it("Should create filebrowser and show standart toolbar",function(e){var t=new Jodit.modules.FileBrowser(null,{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}});t.open(function(){}).then(function(){expect(t.dialog.dialogbox_header.querySelectorAll(".jodit_toolbar_btn").length).to.be.equal(12),t.close(),e()})["catch"](function(e){throw e})})}),describe("Disable buttons",function(){describe("Edit button",function(){it("Should be disable while not selected some image",function(e){var t=new Jodit.modules.FileBrowser(null,{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}});t.open(function(){}).then(function(){var o=t.dialog.dialogbox_header.querySelector(".jodit_toolbar_btn-edit");expect(o).to.be.not["null"],expect(o.classList.contains("jodit_disabled")).to.be["true"],simulateEvent("click",0,t.browser.querySelector('.jodit_filebrowser_files_item[data-is-file="0"]')),expect(o.classList.contains("jodit_disabled")).to.be["false"],t.close(),e()})["catch"](function(e){throw e})}),it("Should be disabled if selected more then 1 image or some file",function(e){var t=new Jodit.modules.FileBrowser(null,{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}});t.open(function(){}).then(function(){var o=t.dialog.dialogbox_header.querySelector(".jodit_toolbar_btn-edit");expect(o).to.be.not["null"],expect(o.classList.contains("jodit_disabled")).to.be["true"],expect(o.classList.contains("jodit_disabled")).to.be["true"],simulateEvent("click",0,t.browser.querySelectorAll('.jodit_filebrowser_files_item[data-is-file="0"]')[0]),expect(o.classList.contains("jodit_disabled")).to.be["false"],simulateEvent("click",0,t.browser.querySelectorAll('.jodit_filebrowser_files_item[data-is-file="0"]')[1],function(e){e[navigator.userAgent.indexOf("Mac OS X")?"metaKey":"ctrlKey"]=!0}),expect(o.classList.contains("jodit_disabled")).to.be["true"],t.close(),e()})["catch"](function(e){throw e})}),describe("Allow all buttons if permission handle is not set",function(){describe("If deny remove action",function(){it("Should not use permission hash and canI method",function(e){defaultPermissions.permissions.allowFileRemove=!1;var t=new Jodit.modules.FileBrowser(null,{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}});t.open(function(){}).then(function(){var o=t.dialog.dialogbox_header.querySelector(".jodit_toolbar_btn-remove");expect(o).to.be.not["null"],expect(o.classList.contains("jodit_disabled")).to.be["true"],simulateEvent("click",0,t.browser.querySelector('.jodit_filebrowser_files_item[data-is-file="0"]')),expect(o.classList.contains("jodit_disabled")).to.be["true"],t.close(),e()})["catch"](function(e){throw e})})}),describe("If not set permission api option",function(){it("Should not use permission hash and canI method",function(e){defaultPermissions.permissions.allowFileRemove=!1;var t=new Jodit.modules.FileBrowser(null,{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"},permissions:null});t.open(function(){}).then(function(){var o=t.dialog.dialogbox_header.querySelector(".jodit_toolbar_btn-remove");expect(o).to.be.not["null"],expect(o.classList.contains("jodit_disabled")).to.be["true"],simulateEvent("click",0,t.browser.querySelector('.jodit_filebrowser_files_item[data-is-file="0"]')),expect(o.classList.contains("jodit_disabled")).to.be["false"],t.close(),e()})["catch"](function(e){throw e})})})})})}),describe("View",function(){it("Should show filebrowser in default view",function(e){var t=new Jodit.modules.FileBrowser(null,{view:"tiles",ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}});t.open(function(){}).then(function(){var o=t.dialog.dialogbox_header.querySelector(".jodit_toolbar_btn-tiles"),i=t.dialog.dialogbox_header.querySelector(".jodit_toolbar_btn-list"),n=t.browser.querySelector(".jodit_filebrowser_files");expect(n).to.be.not["null"],expect(n.classList.contains("jodit_filebrowser_files_view-tiles")).to.be["true"],expect(o.classList.contains("jodit_active")).to.be["true"],expect(i.classList.contains("jodit_active")).to.be["false"],t.close(),e()})["catch"](function(e){throw e})}),describe("Change view",function(){it("Should change filebrowser view",function(e){var t=new Jodit.modules.FileBrowser(null,{view:"tiles",ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}});t.open(function(){}).then(function(){var o=t.dialog.dialogbox_header.querySelector(".jodit_toolbar_btn-tiles"),i=t.dialog.dialogbox_header.querySelector(".jodit_toolbar_btn-list"),n=t.browser.querySelector(".jodit_filebrowser_files");expect(n).to.be.not.equal(null),expect(n.classList.contains("jodit_filebrowser_files_view-tiles")).to.be["true"],expect(o.classList.contains("jodit_active")).to.be["true"],expect(i.classList.contains("jodit_active")).to.be["false"],simulateEvent("mousedown",0,i),expect(n.classList.contains("jodit_filebrowser_files_view-tiles")).to.be["false"],expect(n.classList.contains("jodit_filebrowser_files_view-list")).to.be["true"],expect(o.classList.contains("jodit_active")).to.be["false"],expect(i.classList.contains("jodit_active")).to.be["true"],t.close(),e()})["catch"](function(e){throw e})})})}),describe("Filter",function(){it("Should show only filterd items",function(e){var t=new Jodit.modules.FileBrowser(null,{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}});t.open(function(){}).then(function(){var o=t.dialog.dialogbox_header.querySelector(".jodit_toolbar_btn-filter"),i=o.querySelector("input"),n=t.browser.querySelector(".jodit_filebrowser_files");expect(n).to.be.not["null"],expect(o).to.be.not["null"],expect(i).to.be.not["null"];var l=n.querySelectorAll(".jodit_filebrowser_files_item").length;i.value="i",simulateEvent("keydown",0,i),expect(n.querySelectorAll(".jodit_filebrowser_files_item").length).to.be.not.equal(l),i.value="",simulateEvent("keydown",0,i),expect(n.querySelectorAll(".jodit_filebrowser_files_item").length).to.be.equal(l),t.close(),e()})["catch"](function(e){throw e})})}),describe("Sort",function(){it("Should sort elements by filter select",function(e){var t=new Jodit.modules.FileBrowser(null,{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}});t.open(function(){}).then(function(){var o=t.dialog.dialogbox_header.querySelector(".jodit_toolbar_btn-sort"),i=o.querySelector("select"),n=t.browser.querySelector(".jodit_filebrowser_files");expect(n).to.be.not["null"],expect(o).to.be.not["null"],expect(i).to.be.not["null"];n.querySelectorAll(".jodit_filebrowser_files_item").length;i.value="changed",simulateEvent("change",0,i);var l=n.querySelectorAll(".jodit_filebrowser_files_item");expect([].map.call(l,function(e){return e.querySelector(".jodit_filebrowser_files_item-info-filename").innerText}).join(",")).to.be.equal("test.txt,ibanez-s520-443140.jpg,1966051_524428741092238_1051008806888563137_o.jpg,images.jpg"),i.value="name",simulateEvent("change",0,i),l=n.querySelectorAll(".jodit_filebrowser_files_item"),expect([].map.call(l,function(e){return e.querySelector(".jodit_filebrowser_files_item-info-filename").innerText}).join(",")).to.be.equal("1966051_524428741092238_1051008806888563137_o.jpg,ibanez-s520-443140.jpg,images.jpg,test.txt"),i.value="size",simulateEvent("change",0,i),l=n.querySelectorAll(".jodit_filebrowser_files_item"),expect([].map.call(l,function(e){return e.querySelector(".jodit_filebrowser_files_item-info-filename").innerText}).join(",")).to.be.equal("images.jpg,ibanez-s520-443140.jpg,test.txt,1966051_524428741092238_1051008806888563137_o.jpg"),t.close(),e()})["catch"](function(e){throw e})})}),describe("Select button",function(){it("Should fire first callback in open method",function(e){var t=new Jodit.modules.FileBrowser(null,{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}});t.open(function(o){expect(o!==undefined).to.be["true"],expect(o.files!==undefined).to.be["true"],expect(o.files.length).to.be.equal(1),expect(o.files[0]).to.be.equal("https://xdsoft.net/jodit/files/images.jpg"),t.close(),e()}).then(function(){var e=t.dialog.dialogbox_header.querySelector(".jodit_toolbar_btn-select"),o=t.browser.querySelector(".jodit_filebrowser_files");expect(o).to.be.not["null"],expect(e).to.be.not["null"],expect(e.classList.contains("jodit_disabled")).to.be["true"],simulateEvent("click",0,t.browser.querySelector(".jodit_filebrowser_files_item")),expect(e.classList.contains("jodit_disabled")).to.be["false"],simulateEvent("mousedown",0,e)})["catch"](function(e){throw e})})})}),describe("Test drag and drop",function(){describe("Drag and drop image from filebrowser",function(){it("Should create IMG element in editor",function(e){var t=new Jodit(appendTestArea(),{filebrowser:{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}}}),o=t.getInstance("FileBrowser");o.open(function(){}).then(function(){var i=o.browser.querySelector(".jodit_filebrowser_files");expect(i).to.be.not["null"],simulateEvent("dragstart",0,i.querySelector(".jodit_filebrowser_files_item img")),simulateEvent("dragover",0,window,function(e){e.clientX=50,e.clientY=20+offset(t.editor).top});var n=t.ownerDocument.querySelector('img[data-src="https://xdsoft.net/jodit/files/images.jpg"][alt="images.jpg"][style*="fixed"]');expect(n).to.be.not["null"],expect(n.style.position).to.be.equal("fixed"),simulateEvent("drop",0,t.editor,function(e){Object.defineProperty(e,"dataTransfer",{value:{files:[]}})}),expect(t.value).to.be.equal('<img src="https://xdsoft.net/jodit/files/images.jpg">'),expect(n.parentNode).to.be.not["null"],simulateEvent("drop",0,window),expect(n.parentNode).to.be["null"],e()})["catch"](function(e){throw e})})}),describe("Drag and drop File from filebrowser",function(){it("Should create A element in editor",function(e){var t=new Jodit(appendTestArea(),{filebrowser:{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}}}),o=t.getInstance("FileBrowser");o.open(function(){}).then(function(){var i=o.browser.querySelector(".jodit_filebrowser_files");expect(i).to.be.not["null"],simulateEvent("dragstart",0,i.querySelector('.jodit_filebrowser_files_item[data-is-file="1"] img')),simulateEvent("dragover",0,window,function(e){e.clientX=50,e.clientY=20+offset(t.editor).top});var n=t.ownerDocument.querySelector('img[data-src="https://xdsoft.net/jodit/files/test.txt"][alt="test.txt"][style*="fixed"]');expect(n).to.be.not["null"],expect(n.style.position).to.be.equal("fixed"),simulateEvent("drop",0,t.editor,function(e){Object.defineProperty(e,"dataTransfer",{value:{files:[]}})}),expect(t.value).to.be.equal('<a href="https://xdsoft.net/jodit/files/test.txt">https://xdsoft.net/jodit/files/test.txt</a>'),expect(n.parentNode).to.be.not["null"],simulateEvent("drop",0,window),expect(n.parentNode).to.be["null"],e()})["catch"](function(e){throw e})})})}),describe("Uploader",function(){describe("Drag and drop",function(){describe("Image",function(){it("Should create IMG element",function(e){var t=new Jodit(appendTestArea(),{uploader:{url:"https://xdsoft.net/jodit/connector/index.php?action=fileUpload"},filebrowser:{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}}});t.value="",t.events.on("filesWereUploaded",function(){expect(t.value).to.be.equal('<img src="https://xdsoft.net/jodit/files/test.png">'),e()}),simulateEvent("drop",0,t.editor,function(e){Object.defineProperty(e,"dataTransfer",{value:{files:[{name:"test.png",type:"image/png"}]}})})})}),describe("File",function(){it("Should create A element",function(e){var t=new Jodit(appendTestArea(),{uploader:{url:"https://xdsoft.net/jodit/connector/index.php?action=fileUpload"},filebrowser:{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}}});t.value="",t.events.on("filesWereUploaded",function(){expect(t.value).to.be.equal('<a href="https://xdsoft.net/jodit/files/test.txt">https://xdsoft.net/jodit/files/test.txt</a>'),e()}),simulateEvent("drop",0,t.editor,function(e){Object.defineProperty(e,"dataTransfer",{value:{files:[{name:"test.txt",type:"plain/text"}]}})})})})})}),afterEach(removeStuff)});