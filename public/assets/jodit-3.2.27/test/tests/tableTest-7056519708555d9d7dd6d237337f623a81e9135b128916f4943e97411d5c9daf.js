describe("Tables Jodit Editor Tests",function(){describe("Methods",function(){it("After init container must has one element .jodit_table_resizer",function(){var t=new Jodit(appendTestArea());expect(t.editor.querySelector(".jodit_table_resizer")).to.equal(null),t.selection.insertNode(Jodit.modules.Dom.create("table","",t.editorDocument)),t.selection.insertNode(Jodit.modules.Dom.create("table","",t.editorDocument)),expect(t.container.querySelectorAll(".jodit_table_resizer").length).to.equal(1)}),it("Process wrong tabel",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td data-jodit-selected-cell="1">1</td><td data-jodit-selected-cell="1">2</td><td rowspan="2">3</td></tr><tr><td>4</td></tr></table>'),Jodit.modules.Table.mergeSelected(t.editor.firstChild),expect(t.container.querySelectorAll(".jodit_table_resizer").length).to.equal(1)}),it("Method getRowsCount should return TR count",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table>"+[1,2,3,4].map(function(){return"<tr><td>1</td><td>2</td></tr>"}).join("")+"</table>"),expect(Jodit.modules.Table.getRowsCount(t.editor.firstChild)).to.equal(4)}),it("Method getColumnsCount should return maximum of TH or TD in one row in table",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td>1</td><td>2</td><td>3</td></tr><tr><td>1</td><td>2</td><td>3</td></tr><tr><td colspan="2">12</td><td>3</td></tr><tr><td colspan="3">123</td></tr><tr><td colspan="3">123</td><td>4</td></tr></table>'),expect(Jodit.modules.Table.getColumnsCount(t.editor.firstChild)).to.equal(4)}),it("Method appendRow should append one row in the end of table",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2</td><td>3</td></tr></table>"),Jodit.modules.Table.appendRow(t.editor.firstChild),expect(t.getEditorValue()).to.equal("<table><tbody><tr><td>1</td><td>2</td><td>3</td></tr><tr><td></td><td></td><td></td></tr></tbody></table>")}),it("Method appendRow with second argument should append one row after row",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2</td><td>3</td></tr><tr><td>2</td><td>3</td><td>4</td></tr></table>"),Jodit.modules.Table.appendRow(t.editor.firstChild,t.editor.firstChild.querySelector("tr")),expect(t.getEditorValue()).to.equal("<table><tbody><tr><td>1</td><td>2</td><td>3</td></tr><tr><td></td><td></td><td></td></tr><tr><td>2</td><td>3</td><td>4</td></tr></tbody></table>")}),it("Method appendRow with second=TR  and third=false arguments should append and one row before row",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2</td><td>3</td></tr><tr><td>2</td><td>3</td><td>4</td></tr></table>"),Jodit.modules.Table.appendRow(t.editor.firstChild,t.editor.firstChild.querySelector("tr"),!1),expect(t.getEditorValue()).to.equal("<table><tbody><tr><td></td><td></td><td></td></tr><tr><td>1</td><td>2</td><td>3</td></tr><tr><td>2</td><td>3</td><td>4</td></tr></tbody></table>")}),it("Method appendColumn should append column in the end",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td>1</td><td>2</td></tr><tr><td colspan="2">3</td></tr></table>'),Jodit.modules.Table.appendColumn(t.editor.firstChild),expect(t.getEditorValue().toLowerCase()).to.equal('<table><tbody><tr><td>1</td><td>2</td><td></td></tr><tr><td colspan="2">3</td><td></td></tr></tbody></table>')}),it("Method appendColumn with second argument should append column after that column",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td>1</td><td>2</td></tr><tr><td colspan="2">3</td></tr></table>'),Jodit.modules.Table.appendColumn(t.editor.firstChild,0),expect(t.getEditorValue().toLowerCase()).to.equal('<table><tbody><tr><td>1</td><td></td><td>2</td></tr><tr><td colspan="3">3</td></tr></tbody></table>')}),it("Method appendColumn with second argument and third = false should append column before that column",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td>1</td><td>2</td></tr><tr><td colspan="2">3</td></tr></table>'),Jodit.modules.Table.appendColumn(t.editor.firstChild,1,!1),expect(t.getEditorValue().toLowerCase()).to.equal('<table><tbody><tr><td>1</td><td></td><td>2</td></tr><tr><td colspan="3">3</td></tr></tbody></table>')}),it("Remove row should delete TR from table",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td>1</td><td>2</td><td>3</td></tr><tr><td rowspan="2">4</td><td>5</td><td>6</td></tr><tr><td>7</td><td>8</td></tr></table>'),simulateEvent("mousedown",Jodit.KEY_TAB,t.editor.querySelectorAll("td")[4]),Jodit.modules.Table.removeRow(t.editor.firstChild,1),expect(t.getEditorValue().toLowerCase()).to.equal("<table><tbody><tr><td>1</td><td>2</td><td>3</td></tr><tr><td>4</td><td>7</td><td>8</td></tr></tbody></table>")}),describe("Method merge selected cells",function(){it("Simple should merge all selected cells into one ",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td data-jodit-selected-cell="1">1</td><td data-jodit-selected-cell="1">2</td></tr><tr><td data-jodit-selected-cell="1">3</td><td data-jodit-selected-cell="1">4</td></tr><tr><td>5</td><td>6</td></tr></table>'),Jodit.modules.Table.mergeSelected(t.editor.firstChild),expect(sortAtrtibutes(t.editor.innerHTML)).to.equal('<table><tbody><tr><td colspan="2" data-jodit-selected-cell="1">1<br>2<br>3<br>4</td></tr><tr><td>5</td><td>6</td></tr></tbody></table>')}),it("With colspan and rowspan into one ",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td colspan="2" data-jodit-selected-cell="1">1</td></tr><tr><td data-jodit-selected-cell="1">3</td><td data-jodit-selected-cell="1">4</td></tr><tr><td rowspan="2" data-jodit-selected-cell="1">5</td><td data-jodit-selected-cell="1">6</td></tr><tr><td data-jodit-selected-cell="1">7</td></tr><tr><td>8</td><td>9</td></tr></table>'),Jodit.modules.Table.mergeSelected(t.editor.firstChild),expect(sortAtrtibutes(t.editor.innerHTML)).to.equal('<table><tbody><tr><td colspan="2" data-jodit-selected-cell="1">1<br>3<br>4<br>5<br>6<br>7</td></tr><tr><td>8</td><td>9</td></tr></tbody></table>')}),it("A few cells with colspan and rowspan",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table style="width: 100%;"><tbody><tr><td data-jodit-selected-cell="1" colspan="3">0,0<br>0,1<br>0,2<br></td><td>0,3</td></tr><tr><td data-jodit-selected-cell="1" rowspan="3">1,0<br>2,0<br>3,0<br></td><td data-jodit-selected-cell="1">1,1</td><td data-jodit-selected-cell="1">1,2</td><td>1,3</td></tr><tr><td data-jodit-selected-cell="1">2,1</td><td data-jodit-selected-cell="1">2,2</td><td>2,3</td></tr><tr><td data-jodit-selected-cell="1">3,1</td><td data-jodit-selected-cell="1">3,2</td><td>3,3</td></tr></tbody></table>'),Jodit.modules.Table.mergeSelected(t.editor.firstChild),expect(sortAtrtibutes(t.editor.innerHTML)).to.equal('<table style="width:100%"><tbody><tr><td data-jodit-selected-cell="1" rowspan="4">0,0<br>0,1<br>0,2<br><br>1,0<br>2,0<br>3,0<br><br>1,1<br>1,2<br>2,1<br>2,2<br>3,1<br>3,2</td><td>0,3</td></tr><tr><td>1,3</td></tr><tr><td>2,3</td></tr><tr><td>3,3</td></tr></tbody></table>')}),it("Merge cells in center",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table style="width: 100%;"><tbody><tr><td colspan="3" class="">0,0<br>0,1<br>0,2<br></td><td>0,3</td></tr><tr><td rowspan="3" class="">1,0<br>2,0<br>3,0<br></td><td data-jodit-selected-cell="1">1,1</td><td data-jodit-selected-cell="1">1,2</td><td data-jodit-selected-cell="1">1,3</td></tr><tr><td data-jodit-selected-cell="1">2,1</td><td data-jodit-selected-cell="1">2,2</td><td data-jodit-selected-cell="1">2,3</td></tr><tr><td class="">3,1</td><td class="">3,2</td><td>3,3</td></tr></tbody></table>'),Jodit.modules.Table.mergeSelected(t.editor.firstChild),expect(sortAtrtibutes(t.editor.innerHTML)).to.equal('<table style="width:100%"><tbody><tr><td colspan="3">0,0<br>0,1<br>0,2<br></td><td>0,3</td></tr><tr><td rowspan="2">1,0<br>2,0<br>3,0<br></td><td colspan="3" data-jodit-selected-cell="1">1,1<br>1,2<br>1,3<br>2,1<br>2,2<br>2,3</td></tr><tr><td>3,1</td><td>3,2</td><td>3,3</td></tr></tbody></table>')}),it("Normalize merged cells",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tbody><tr><td colspan="3" data-jodit-selected-cell="1" rowspan="4">1</td><td data-jodit-selected-cell="1" rowspan="4">2</td></tr><tr></tr><tr></tr><tr></tr></tbody></table>'),Jodit.modules.Table.mergeSelected(t.editor.firstChild),expect(sortAtrtibutes(t.editor.innerHTML)).to.equal('<table><tbody><tr><td data-jodit-selected-cell="1">1<br>2</td></tr></tbody></table>')})}),describe("Split selected cells",function(){it("Split cell by Horizontal",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tbody><tr><td data-jodit-selected-cell="1">0,0</td></tr><tr><td>1,0</td></tr></tbody></table>'),Jodit.modules.Table.splitHorizontal(t.editor.firstChild),expect(sortAtrtibutes(t.editor.innerHTML)).to.equal("<table><tbody><tr><td>0,0</td></tr><tr><td><br></td></tr><tr><td>1,0</td></tr></tbody></table>")}),it("Split cell with rowspan by horizontal ",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tbody><tr><td>0,0</td><td>0,1</td><td>0,2</td></tr><tr><td rowspan="2" data-jodit-selected-cell="1">1,0</td><td>1,1</td><td rowspan="2">1,2</td></tr><tr><td><br></td></tr><tr><td>2,0</td><td>2,1</td><td>2,2</td></tr></tbody></table>'),Jodit.modules.Table.splitHorizontal(t.editor.firstChild),expect(sortAtrtibutes(t.editor.innerHTML)).to.equal('<table><tbody><tr><td>0,0</td><td>0,1</td><td>0,2</td></tr><tr><td>1,0</td><td>1,1</td><td rowspan="2">1,2</td></tr><tr><td><br></td><td><br></td></tr><tr><td>2,0</td><td>2,1</td><td>2,2</td></tr></tbody></table>')}),it("Split cell with rowspan by horizontal 2",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tbody><tr><td>0,0</td><td>0,1</td><td>0,2</td></tr><tr><td rowspan="2">1,0</td><td rowspan="2" data-jodit-selected-cell="1">1,1</td><td>1,2</td></tr><tr><td><br></td></tr><tr><td>2,0</td><td>2,1</td><td>2,2</td></tr></tbody></table>'),Jodit.modules.Table.splitHorizontal(t.editor.firstChild),expect(sortAtrtibutes(t.editor.innerHTML)).to.equal('<table><tbody><tr><td>0,0</td><td>0,1</td><td>0,2</td></tr><tr><td rowspan="2">1,0</td><td>1,1</td><td>1,2</td></tr><tr><td><br></td><td><br></td></tr><tr><td>2,0</td><td>2,1</td><td>2,2</td></tr></tbody></table>')}),it("Split cell by vertical",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table style="width: 300px;"><tbody><tr><td style="width:100px" data-jodit-selected-cell="1">0,0</td><td>0,1</td></tr><tr><td>1,0</td><td>1,1</td></tr></tbody></table>'),Jodit.modules.Table.splitVertical(t.editor.firstChild),expect(sortAtrtibutes(t.editor.innerHTML)).to.equal('<table style="width:300px"><tbody><tr><td style="width:16.66%">0,0</td><td style="width:16.66%"><br></td><td>0,1</td></tr><tr><td colspan="2">1,0</td><td>1,1</td></tr></tbody></table>')})})}),describe("Work with tables",function(){it("Create table and insert into cell some text",function(){var t=new Jodit(appendTestArea());t.ownerWindow.focus(),t.value="";var e=Jodit.modules.Dom.create("table","",t.editorDocument),d=Jodit.modules.Dom.create("tr","",t.editorDocument),o=Jodit.modules.Dom.create("td","",t.editorDocument),r=Jodit.modules.Dom.create("td","",t.editorDocument);d.appendChild(o),d.appendChild(r),e.appendChild(d),t.selection.focus(),t.selection.insertNode(e,!1),t.selection.setCursorIn(e,!1),t.selection.insertNode(Jodit.modules.Dom.create("text","ok",t.editorDocument)),expect(t.value).to.equal("<table><tr><td></td><td>ok</td></tr></table>")}),it("After insert table like html without tbody, it should be appear",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2</td></tr></table>"),expect(t.getEditorValue()).to.equal("<table><tbody><tr><td>1</td><td>2</td></tr></tbody></table>")}),it("After press Tab button cursor should be in next cell in table",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2</td></tr></table>"),t.selection.setCursorIn(t.editor.querySelector("td")),simulateEvent("keydown",Jodit.KEY_TAB,t.editor),t.selection.insertNode(Jodit.modules.Dom.create("text","test",t.editorDocument),!1),expect(t.value.replace("<br>","")).to.equal("<table><tbody><tr><td>1</td><td>test</td></tr></tbody></table>")}),it("After press Tab + Shift buttons cursor should be in next cell in table",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2</td></tr></table>"),t.selection.setCursorIn(t.editor.querySelector("td").nextSibling),simulateEvent("keydown",Jodit.KEY_TAB,t.editor,function(t){t.shiftKey=!0}),t.selection.insertNode(Jodit.modules.Dom.create("text","test",t.editorDocument),!1),expect(t.value.replace("<br>","")).to.equal("<table><tbody><tr><td>test</td><td>2</td></tr></tbody></table>")}),it("After press Right arrow not in the end of cell it should do nothing",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2</td></tr></table>"),t.selection.setCursorIn(t.editor.querySelector("td"),!0),simulateEvent("keydown",Jodit.KEY_RIGHT,t.editor),t.selection.insertNode(Jodit.modules.Dom.create("text","test",t.editorDocument),!1),expect(t.getEditorValue()).to.equal("<table><tbody><tr><td>test1</td><td>2</td></tr></tbody></table>")}),it("After press Left arrow in the start of cell it should work like tab + shift",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2</td></tr></table>"),t.selection.setCursorIn(t.editor.querySelector("td").nextSibling,!0),simulateEvent("keydown",Jodit.KEY_LEFT,t.editor),t.selection.insertNode(Jodit.modules.Dom.create("text","test",t.editorDocument),!1),expect(t.getEditorValue()).to.equal("<table><tbody><tr><td>1test</td><td>2</td></tr></tbody></table>")}),it("After press Top arrow in the first cell's line cursor should move into top cell",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2</td></tr><tr><td>3</td><td>4<br>5<br>6</td></tr></table>"),t.selection.setCursorAfter(t.editor.querySelectorAll("td")[3].firstChild),simulateEvent("keydown",Jodit.KEY_UP,t.editor),t.selection.insertNode(Jodit.modules.Dom.create("text","test",t.editorDocument),!1),expect(t.getEditorValue()).to.equal("<table><tbody><tr><td>1</td><td>2test</td></tr><tr><td>3</td><td>4<br>5<br>6</td></tr></tbody></table>")}),it("After press Bottom arrow in the first cell's line cursor should move into bottom cell",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2<br>3</td></tr><tr><td>4</td><td>5</td></tr></table>"),t.selection.setCursorAfter(t.editor.querySelectorAll("td")[1].lastChild),simulateEvent("keydown",Jodit.KEY_DOWN,t.editor),t.selection.insertNode(Jodit.modules.Dom.create("text","test",t.editorDocument),!1),expect(t.getEditorValue()).to.equal("<table><tbody><tr><td>1</td><td>2<br>3</td></tr><tr><td>4</td><td>test5</td></tr></tbody></table>")}),it("After press Tab in last table's cell in table should add new row and move into first cell form it",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2</td></tr></table>"),t.selection.setCursorAfter(t.editor.querySelectorAll("td")[1].lastChild),simulateEvent("keydown",Jodit.KEY_TAB,t.editor),t.selection.insertNode(Jodit.modules.Dom.create("text","test",t.editorDocument),!1),expect(t.getEditorValue()).to.equal("<table><tbody><tr><td>1</td><td>2</td></tr><tr><td>test<br></td><td></td></tr></tbody></table>")}),describe("Remove row",function(){it("Remove simple row without rowspan should simple remove row",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2</td></tr><tr><td>3</td><td>4</td></tr></table>");new Jodit.modules.Table(t);Jodit.modules.Table.removeRow(t.editor.firstChild,0),expect(t.getEditorValue().toLowerCase()).to.equal("<table><tbody><tr><td>3</td><td>4</td></tr></tbody></table>")}),it("Remove row which not consists td, because of in previous row was cell with rowspan should simple remove row and decrement rowspan",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td rowspan="2">1</td><td>2</td></tr><tr><td>3</td></tr></table>'),Jodit.modules.Table.removeRow(t.editor.firstChild,1),expect(t.getEditorValue().toLowerCase()).to.equal("<table><tbody><tr><td>1</td><td>2</td></tr></tbody></table>")}),it("Remove row which not consists td, because of in previous row was cell with rowspan and colspan should simple remove row and decrement rowspan once time",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td rowspan="3" colspan="2">1</td><td>2</td></tr><tr><td>3</td></tr><tr><td>4</td></tr><tr><td>5</td><td>6</td><td>7</td></tr></table>'),Jodit.modules.Table.removeRow(t.editor.firstChild,1),expect(t.getEditorValue().toLowerCase()).to.equal('<table><tbody><tr><td rowspan="2" colspan="2">1</td><td>2</td></tr><tr><td>4</td></tr><tr><td>5</td><td>6</td><td>7</td></tr></tbody></table>')}),it("Remove row which consists td with rowspan should simple remove row and decrement rowspan and move that cell into next row",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td rowspan="2">1</td><td>2</td></tr><tr><td>3</td></tr></table>'),Jodit.modules.Table.removeRow(t.editor.firstChild,0),expect(t.getEditorValue().toLowerCase()).to.equal("<table><tbody><tr><td>1</td><td>3</td></tr></tbody></table>")}),it("Remove row which consists td with rowspan and colspan should simple remove row and decrement rowspan and move that cell into next row",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td rowspan="2" colspan="2">1</td><td>2</td></tr><tr><td>3</td></tr><tr><td>4</td><td>5</td><td>6</td></tr></table>'),Jodit.modules.Table.removeRow(t.editor.firstChild,0),expect(t.getEditorValue().toLowerCase()).to.equal('<table><tbody><tr><td colspan="2">1</td><td>3</td></tr><tr><td>4</td><td>5</td><td>6</td></tr></tbody></table>')}),it("Remove row which consists last td with rowspan and colspan should simple remove row and decrement rowspan and move that cell into next row in last position",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td>1</td><td>2</td><td>3</td></tr><tr><td>4</td><td colspan="2" rowspan="2">5</td></tr><tr><td>6</td></tr></table>'),Jodit.modules.Table.removeRow(t.editor.firstChild,1),expect(t.getEditorValue().toLowerCase()).to.equal('<table><tbody><tr><td>1</td><td>2</td><td>3</td></tr><tr><td>6</td><td colspan="2">5</td></tr></tbody></table>')})}),describe("Remove column",function(){it("Remove simple column without colspan should simple remove all cells in column",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2</td></tr><tr><td>3</td><td>4</td></tr><tr><td>5</td><td>6</td></tr></table>"),Jodit.modules.Table.removeColumn(t.editor.firstChild,0),expect(t.getEditorValue().toLowerCase()).to.equal("<table><tbody><tr><td>2</td></tr><tr><td>4</td></tr><tr><td>6</td></tr></tbody></table>")}),it("Remove column which consists td with colspan should remove all cells in column but that td should decrement colspan",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td>1</td><td>2</td></tr><tr><td colspan="2">3</td></tr><tr><td>4</td><td>5</td></tr></table>'),Jodit.modules.Table.removeColumn(t.editor.firstChild,0),expect(t.getEditorValue().toLowerCase()).to.equal("<table><tbody><tr><td>2</td></tr><tr><td>3</td></tr><tr><td>5</td></tr></tbody></table>")}),it("Remove column which not consists td with colspan should remove all cells in column but that td should decrement colspan too",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td>1</td><td>2</td></tr><tr><td colspan="2">3</td></tr><tr><td>4</td><td>5</td></tr></table>'),Jodit.modules.Table.removeColumn(t.editor.firstChild,1),expect(t.getEditorValue().toLowerCase()).to.equal("<table><tbody><tr><td>1</td></tr><tr><td>3</td></tr><tr><td>4</td></tr></tbody></table>")}),it("Remove column part of that td (colspan and rowspan) in another column should remove all cells in column but that td should decrement colspan once time",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td>1</td><td>2</td><td>3</td><td>4</td></tr><tr><td>5</td><td colspan="3" rowspan="2">6</td></tr><tr><td>7</td></tr></table>'),Jodit.modules.Table.removeColumn(t.editor.firstChild,3);var e=t.getEditorValue().toLowerCase();e=e.replace("rowspan","colspan"),expect(e).to.equal('<table><tbody><tr><td>1</td><td>2</td><td>3</td></tr><tr><td>5</td><td colspan="2" colspan="2">6</td></tr><tr><td>7</td></tr></tbody></table>')})}),describe("Select cells",function(){it("When we press mouse button over cell and move mouse to another cell, it should select all cells in bound",function(){var t=new Jodit(appendTestArea());t.setEditorValue("<table><tr><td>1</td><td>2</td></tr><tr><td>3</td><td>4</td></tr><tr><td>5</td><td>6</td></tr></table>"),simulateEvent("mousedown",1,t.editor.querySelector("td")),simulateEvent("mousemove",1,t.editor.querySelectorAll("td")[3]),simulateEvent("mouseup",1,t.editor.querySelectorAll("td")[3]),expect(sortAtrtibutes(t.editor.innerHTML)).to.equal('<table><tbody><tr><td data-jodit-selected-cell="1">1</td><td data-jodit-selected-cell="1">2</td></tr><tr><td data-jodit-selected-cell="1">3</td><td data-jodit-selected-cell="1">4</td></tr><tr><td>5</td><td>6</td></tr></tbody></table>')}),it("When we press mouse button over cell in subtable and move mouse to another cell, it should select all cells in bound in that table",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table><tr><td>1</td><td>2</td></tr><tr><td>3</td><td class="test"><table><tr><td>1</td><td>2</td></tr><tr><td>3</td><td>4</td></tr><tr><td>5</td><td>6</td></tr></table></td></tr><tr><td>5</td><td>6</td></tr></table>'),simulateEvent("mousedown",1,t.editor.querySelector(".test").querySelector("td")),simulateEvent("mousemove",1,t.editor.querySelector(".test").querySelectorAll("td")[3]),simulateEvent("mouseup",1,t.editor.querySelector(".test").querySelectorAll("td")[3]),expect(sortAtrtibutes(t.editor.innerHTML)).to.equal('<table><tbody><tr><td>1</td><td>2</td></tr><tr><td>3</td><td class="test"><table><tbody><tr><td data-jodit-selected-cell="1">1</td><td data-jodit-selected-cell="1">2</td></tr><tr><td data-jodit-selected-cell="1">3</td><td data-jodit-selected-cell="1">4</td></tr><tr><td>5</td><td>6</td></tr></tbody></table></td></tr><tr><td>5</td><td>6</td></tr></tbody></table>')}),it("When we press mouse button over cell and move mouse to another cell, it should select all cells in bound even if between be colspan and rowspan",function(){var t=new Jodit(appendTestArea());t.setEditorValue('<table style="width: 100%;"><tbody><tr><td colspan="3">0,0<br>0,1<br>0,2<br></td><td>0,3</td></tr><tr><td rowspan="3">1,0<br>2,0<br>3,0<br></td><td>1,1</td><td>1,2</td><td>1,3</td></tr><tr><td>2,1</td><td>2,2</td><td>2,3</td></tr><tr><td>3,1</td><td>3,2</td><td>3,3</td></tr></tbody></table>'),simulateEvent("mousedown",1,t.editor.querySelectorAll("td")[0]),simulateEvent("mousemove",1,t.editor.querySelectorAll("td")[7]),simulateEvent("mouseup",1,t.editor.querySelectorAll("td")[7]),expect(sortAtrtibutes(t.editor.innerHTML)).to.equal('<table style="width:100%"><tbody><tr><td colspan="3" data-jodit-selected-cell="1">0,0<br>0,1<br>0,2<br></td><td>0,3</td></tr><tr><td data-jodit-selected-cell="1" rowspan="3">1,0<br>2,0<br>3,0<br></td><td data-jodit-selected-cell="1">1,1</td><td data-jodit-selected-cell="1">1,2</td><td>1,3</td></tr><tr><td data-jodit-selected-cell="1">2,1</td><td data-jodit-selected-cell="1">2,2</td><td>2,3</td></tr><tr><td data-jodit-selected-cell="1">3,1</td><td data-jodit-selected-cell="1">3,2</td><td>3,3</td></tr></tbody></table>')})}),describe("Resize column",function(){describe("Move mouse over edge of cell",function(){before(function(){var t=[];for(i=0;i<100;i+=1)t.push(document.createElement("br")),t[t.length-1].classList.add("test"),document.body.appendChild(t[t.length-1])}),describe("Normal scroll",function(){it("should show resizer element",function(t){var e=new Jodit(appendTestArea());window.scrollTo(0,Jodit.modules.Helpers.offset(e.container,e,e.ownerDocument).top+50),e.setEditorValue("<table><tr><td>1</td><td>2</td></tr></table><p>3</p>");var d=Jodit.modules.Helpers.offset(e.editor.querySelectorAll("td")[1],e,e.editorDocument),o=Jodit.modules.Helpers.offset(e.editor.querySelector("table"),e,e.editorDocument);simulateEvent("mousemove",1,e.editor.getElementsByTagName("td")[1],function(t){t.clientX=d.left,t.clientY=d.top,t.pageX=0,t.pageY=0});var r=e.container.querySelector(".jodit_table_resizer");expect(r).to.be.not.equal(null),expect("block"===r.style.display).to.equal(!0);var l=Jodit.modules.Helpers.offset(r,e,e.ownerDocument);expect(Math.abs(l.left-d.left)<10).to.be["true"],expect(Math.abs(l.top-o.top)<10).to.be["true"],simulateEvent("mouseleave",1,e.editor.querySelector("table"),function(t){t.relatedTarget=e.editor.querySelector("p")}),simulateEvent("mousemove",1,e.editor.querySelector("p")),expect("none"===r.style.display).to.equal(!0),t()})}),after(function(){[].slice.call(document.querySelectorAll("br.test")).forEach(function(t){t.parentNode&&t.parentNode.removeChild(t)})})}),it("When move mouse over left edge of cell and press mouse button and move cursor to right in 500 pixels - resizer should be nearby next edge",function(t){var e=new Jodit(appendTestArea());e.setEditorValue('<table style="width: 100px; border-collapse: separate;" cellspacing="0"><tr><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td></tr></table>');var d=e.editor.querySelectorAll("td")[1],o=d.getBoundingClientRect();simulateEvent("mousemove",1,d,function(t){t.clientX=o.left,t.offsetX=0,t.pageX=0,t.pageY=0}),simulateEvent("mousedown",1,e.container.querySelector(".jodit_table_resizer"),function(t){t.clientX=o.left,t.pageX=0,t.pageY=0}),simulateEvent("mousemove",1,e.editorWindow,function(t){t.clientX=o.left+500,t.pageX=0,t.pageY=0}),expect(parseInt(e.container.querySelector(".jodit_table_resizer").style.left,10)<55).to.equal(!0),t()}),describe("Resize column",function(){describe("When move mouse over left edge of cell and press mouse button and move cursor to right in 5 pixels",function(){it("should decrease the width of the right column and the width of the left column should increase",function(t){var e=new Jodit(appendTestArea());e.setEditorValue('<table style="width: 100px; border-collapse: separate;" cellspacing="0"><tr><td>1</td><td>2</td><td>3</td><td>4</td></tr></table>');var d=e.editor.querySelectorAll("td")[1],o=d.getBoundingClientRect();simulateEvent("mousemove",1,d,function(t){t.clientX=o.left,t.offsetX=0,t.pageX=0,t.pageY=0}),simulateEvent("mousedown",1,e.container.querySelector(".jodit_table_resizer"),function(t){t.clientX=o.left,t.pageX=0,t.pageY=0}),simulateEvent("mousemove",1,e.editorWindow,function(t){t.clientX=o.left+5,t.pageX=0,t.pageY=0}),simulateEvent("mouseup",1,window,function(t){t.clientX=o.left+5,t.pageX=0,t.pageY=0}),expect(e.editor.innerHTML.toLowerCase()).to.equal('<table style="width: 100px; border-collapse: separate;" cellspacing="0"><tbody><tr><td style="width: 30%;">1</td><td style="width: 20%;">2</td><td>3</td><td>4</td></tr></tbody></table>'),t()}),describe("After resize",function(){it("it should restore selection",function(t){var e=new Jodit(appendTestArea());e.value='<p>test</p><table style="width: 100px; border-collapse: separate;" cellspacing="0"><tr><td>1</td><td>2</td><td>3</td><td>4</td></tr></table>';var d=e.editor.querySelectorAll("td")[1],o=d.getBoundingClientRect();e.selection.setCursorIn(e.editor.firstChild),simulateEvent("mousemove",1,d,function(t){t.clientX=o.left,t.offsetX=0,t.pageX=0,t.pageY=0}),simulateEvent("mousedown",1,e.container.querySelector(".jodit_table_resizer"),function(t){t.clientX=o.left,t.pageX=0,t.pageY=0}),simulateEvent("mousemove",1,e.editorWindow,function(t){t.clientX=o.left+5,t.pageX=0,t.pageY=0}),simulateEvent("mouseup",1,e.ownerWindow,function(t){t.clientX=o.left+5,t.pageX=0,t.pageY=0}),e.selection.insertHTML("stop"),expect(sortAtrtibutes(e.value)).to.equal('<p>teststop</p><table cellspacing="0" style="border-collapse:separate;width:100px"><tbody><tr><td style="width:30%">1</td><td style="width:20%">2</td><td>3</td><td>4</td></tr></tbody></table>'),t()})})})}),it("When move mouse over right edge of last cell and press mouse button and move cursor to right in 50 pixels - the width of the whole table should increase",function(){var t=new Jodit(appendTestArea());getBox().style.width="202px",t.setEditorValue('<table style="width: 100px; border-collapse: separate;" cellspacing="0"><tr><td>1</td><td>2</td><td>3</td><td>5</td></tr></table>');var e=t.editor.querySelectorAll("td")[3],d=e.getBoundingClientRect();simulateEvent("mousemove",1,e,function(t){t.clientX=d.left+d.width,t.offsetX=d.width}),simulateEvent("mousedown",1,t.container.querySelector(".jodit_table_resizer"),function(t){t.clientX=d.left+d.width}),simulateEvent("mousemove",1,window,function(t){t.clientX=d.left+d.width+50}),simulateEvent("mouseup",1,window,function(t){t.clientX=d.left+d.width+50}),expect(sortAtrtibutes(t.editor.innerHTML.toLowerCase())).to.equal('<table cellspacing="0" style="border-collapse:separate;width:83.33%"><tbody><tr><td>1</td><td>2</td><td>3</td><td>5</td></tr></tbody></table>')}),it("When move mouse over left edge of first cell and press mouse button and move cursor to left in 50 pixels - the width of the whole table should increase",function(){var t=new Jodit(appendTestArea());getBox().style.width="202px",t.setEditorValue('<table style="width: 100px"><tr><td>1</td><td>2</td><td>3</td><td>4</td></tr></table>');var e=t.editor.querySelectorAll("td")[0],d=e.getBoundingClientRect();simulateEvent("mousemove",1,e,function(t){t.clientX=d.left,t.offsetX=0}),simulateEvent("mousedown",1,t.container.querySelector(".jodit_table_resizer"),function(t){t.clientX=d.left}),simulateEvent("mousemove",1,window,function(t){t.clientX=d.left+50}),simulateEvent("mouseup",1,window,function(t){t.clientX=d.left+50}),expect(sortAtrtibutes(t.editor.innerHTML.toLowerCase())).to.equal('<table style="margin-left:27.77%;width:27.77%"><tbody><tr><td>1</td><td>2</td><td>3</td><td>4</td></tr></tbody></table>')})}),describe("Resize table",function(){describe("Image in cell",function(){describe("Mouse down on the Image",function(){it("should show resizer for this image",function(){var t=document.createElement("textarea");t.setAttribute("id","should_show_resizer_for_this_image"),document.body.appendChild(t);var e=new Jodit(t);e.setEditorValue('<table><tr><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td><img style="width:30px" src="tests/artio.jpg"></td></tr></table>'),simulateEvent("mousedown",1,e.editor.querySelector("img"));var d=e.ownerDocument.querySelector(".jodit_resizer[data-editor_id=should_show_resizer_for_this_image]");expect(d&&"block"===d.style.display).to.equal(!0);var o=offset(d),r=offset(e.editor.querySelector("img"));expect(Math.abs(o.left-r.left)<10).to.be["true"],expect(Math.abs(o.top-r.top)<10).to.be["true"],document.body.removeChild(t)})})})})}),afterEach(removeStuff)});