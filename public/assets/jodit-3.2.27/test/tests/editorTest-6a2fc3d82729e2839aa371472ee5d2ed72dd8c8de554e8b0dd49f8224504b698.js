describe("Jodit Editor Tests",function(){describe("Constructor",function(){it("Constructor Jodit must be in global scope",function(){expect(window.Jodit).to.be.a("function")}),describe("First argument",function(){describe("String #id",function(){it("Should be valid selector",function(){var e=appendTestArea("editor"),t=new Jodit("#editor");expect(t.element).to.equal(e),t.destruct()})}),describe("Undefined,null,false,bad seelctor,function,number, text node",function(){it("Should be not valid selector",function(){expect(function(){new Jodit(0)}).to["throw"](Error),expect(function(){new Jodit}).to["throw"](Error),expect(function(){new Jodit(null)}).to["throw"](Error),expect(function(){new Jodit(!1)}).to["throw"](Error),expect(function(){new Jodit(".salomon")}).to["throw"](Error),expect(function(){new Jodit(">asdsad.salomon")}).to["throw"](Error),expect(function(){new Jodit(function(){})}).to["throw"](Error),expect(function(){new Jodit(233)}).to["throw"](Error);var e=document.createTextNode("stop");expect(function(){new Jodit(e)}).to["throw"](Error)})}),describe("HTMLTextAreaElement",function(){it("Should be instance of HTMLElement",function(){var e=appendTestArea("editor2"),t=new Jodit(e);expect(t.element).to.equal(e),t.destruct()})}),describe("HTMLDivElement",function(){it("Should be instance of HTMLElement",function(){var e=document.createElement("div");e.innerHTML="<h1>Test</h1>",document.body.appendChild(e);var t=new Jodit(e);expect(t.element).to.equal(e),expect("<h1>Test</h1>").to.equal(t.getEditorValue()),t.destruct(),document.body.removeChild(e)})}),describe("Found element",function(){it("Should be instance of HTMLElement",function(){var e=document.createElement("div");e.innerHTML="<h1>Test</h1>",e.setAttribute("id","test2222"),document.body.appendChild(e);var t=document.getElementById("test2222"),o=new Jodit(t);expect(o.element).to.equal(t),expect("<h1>Test</h1>").to.equal(o.getEditorValue()),o.destruct(),document.body.removeChild(e)})})}),it("Editor should replace and hide source textarea",function(){var e=appendTestArea(),t=new Jodit(e);expect(e.style.display).to.equal("none"),t.options.iframe?expect(t.editor).to.equal(t.editorDocument.body):expect(t.editor).to.equal(document.querySelector(".jodit_wysiwyg"))}),describe("Options",function(){it("Options should be inherited from the default values",function(){var e=appendTestArea(),t=new Jodit(e,{zIndex:1986});expect(t.options.zIndex).to.equal(1986),expect(t.options.spellcheck).to.equal(!0)}),describe("Set nested array",function(){it("Should create editor with merged default array and set array",function(){var e=appendTestArea();Jodit.defaultOptions.someArray={data:[1,2,3,4]};var t=new Jodit(e,{someArray:{data:[5,6,7]}});expect(t.options.someArray.data.toString()).to.equal("5,6,7,4")}),describe("Set nested array like Jodit.Array",function(){it("Should create editor with set array",function(){var e=appendTestArea();Jodit.defaultOptions.someArray={data:[1,2,3,4]};var t=new Jodit(e,{someArray:{data:Jodit.Array([5,6,7])}});expect(t.options.someArray.data.toString()).to.equal("5,6,7")})})}),describe("Set nested object",function(){it("Should create editor with merged default object and set object",function(){var e=appendTestArea();Jodit.defaultOptions.someObject={data:{left:10,right:20}};var t=new Jodit(e,{someObject:{data:{top:10,right:10}}});expect(JSON.stringify(t.options.someObject.data)).to.equal('{"left":10,"right":10,"top":10}')}),describe("Set nested object like Jodit.Object",function(){it("Should create editor with set object",function(){var e=appendTestArea();Jodit.defaultOptions.someObject={data:{left:10,right:20}};var t=new Jodit(e,{someObject:{data:Jodit.Object({top:10,right:10})}});expect(JSON.stringify(t.options.someObject.data)).to.equal('{"top":10,"right":10}')})})})}),describe("Sizes",function(){describe("Set fixed height",function(){it("Should set editor height by option",function(){var e=appendTestArea(),t=new Jodit(e,{height:300});t.setEditorValue("<p>test</p>".repeat(100)),expect(t.container.offsetHeight).to.be.below(1e3)}),it("Should set editor height by option for iframe",function(){var e=new Jodit(appendTestArea(),{height:300,iframe:!0});e.setEditorValue("<p>test</p>".repeat(100)),expect(e.container.offsetHeight).to.be.below(1e3)}),it("Should not change size by content after window was resized",function(){var e=new Jodit(appendTestArea(),{height:300});e.setEditorValue("<p>test</p>".repeat(20)),expect(e.container.offsetHeight).to.be.equal(300),simulateEvent("resize",0,window),expect(e.container.offsetHeight).to.be.equal(300)}),describe("Fullsize mode",function(){it("Should set heights of workplace to 100% - toolbar's height",function(){var e=new Jodit(appendTestArea(),{fullsize:!0});expect(e.workplace.offsetHeight).to.be.above(300)}),it("Should restore size after fullsized mode",function(){var e=new Jodit(appendTestArea(),{height:300});e.setEditorValue("<p>test</p>".repeat(20)),expect(e.container.offsetHeight).to.be.equal(300),e.toggleFullSize(!0),expect(e.container.offsetHeight).to.be.above(300),e.toggleFullSize(!1),expect(e.container.offsetHeight).to.be.equal(300),expect(e.container.offsetWidth).to.be.above(300)}),it("Should hide resizer",function(){var e=new Jodit(appendTestArea(),{height:300,iframe:!0}),t=e.container.querySelector(".jodit_editor_resize");expect(t).to.be.not.equal(null),e.toggleFullSize(!0),expect(e.ownerWindow.getComputedStyle(t).display).to.be.equal("none")}),it("Should change the icon in toolbar",function(){var e=new Jodit(appendTestArea()),t=e.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-fullsize");expect(t).to.be.not.equal(null),expect(t.querySelector("svg")).to.be.not.equal(null);var o=t.querySelector("svg").innerHTML;e.toggleFullSize(!0),expect(t.querySelector("svg").innerHTML).to.be.not.equal(o),e.toggleFullSize(!1),expect(t.querySelector("svg").innerHTML).to.be.equal(o)}),describe("For text icons",function(){it("Should change the text in toolbar",function(){var e=new Jodit(appendTestArea(),{textIcons:!0}),t=e.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-fullsize");expect(t).to.be.not.equal(null),expect(t.querySelector("svg")).to.be.equal(null);var o=t.innerText;e.toggleFullSize(!0),expect(t.innerText).to.be.not.equal(o),e.toggleFullSize(!1),expect(t.innerText).to.be.equal(o)})})}),it("Should add resize handle",function(){var e=appendTestArea(),t=new Jodit(e,{height:300,iframe:!0});expect(t.container.querySelectorAll(".jodit_editor_resize").length).to.be.equal(1)}),it("Should not change size by content after window was resized",function(){var e=appendTestArea(),t=new Jodit(e,{height:300});t.setEditorValue("<p>test</p>".repeat(20)),expect(t.container.offsetHeight).to.be.equal(300),simulateEvent("resize",0,window),expect(t.container.offsetHeight).to.be.equal(300)}),describe("Resize handle",function(){it("Should resize editor",function(){var e=appendTestArea(),t=new Jodit(e,{height:300,width:400,allowResizeX:!0,allowResizeY:!0}),o=t.container.querySelector(".jodit_editor_resize");expect(t.container.offsetHeight).to.be.equal(300),simulateEvent("mousedown",0,o,function(e){e.clientX=100,e.clientY=100}),simulateEvent("mousemove",0,window,function(e){e.clientX=200,e.clientY=200}),simulateEvent("mouseup",0,window),expect(t.container.offsetHeight).to.be.equal(400),expect(t.container.offsetWidth).to.be.equal(500)}),describe("Disable X resizing",function(){it("Should resize editor only by vertical",function(){var e=appendTestArea(),t=new Jodit(e,{height:300,width:400,allowResizeX:!1,allowResizeY:!0}),o=t.container.querySelector(".jodit_editor_resize");expect(t.container.offsetHeight).to.be.equal(300),simulateEvent("mousedown",0,o,function(e){e.clientX=100,e.clientY=100}),simulateEvent("mousemove",0,window,function(e){e.clientX=200,e.clientY=200}),simulateEvent("mouseup",0,window),expect(t.container.offsetHeight).to.be.equal(400),expect(t.container.offsetWidth).to.be.equal(400)})})})}),describe("Autosize",function(){it("Should set editor height by content",function(){var e=appendTestArea(),t=new Jodit(e);t.setEditorValue("<p>test</p>".repeat(100)),expect(t.container.offsetHeight).to.be.above(1e3)}),it("Should set editor height by content in iframe mode",function(){var e=appendTestArea(),t=new Jodit(e,{iframe:!0});t.setEditorValue("<p>test</p>".repeat(100)),expect(t.container.offsetHeight).to.be.above(1e3)})})}),describe("Check preset",function(){it("Should set option by preset",function(){var e=new Jodit(appendTestArea());expect(e.options.inline).to.be["false"],expect(e.options.toolbar).to.be["true"],expect(e.options.readonly).to.be["false"];var t=new Jodit(appendTestArea(),{preset:"inline"});expect(t.options.inline).to.be["true"],expect(t.options.toolbar).to.be["false"],Jodit.defaultOptions.presets.custom={readonly:!0};var o=new Jodit(appendTestArea(),{preset:"custom"});expect(o.options.readonly).to.be["true"];var n=new Jodit(appendTestArea(),{preset:"inline",inline:!1});expect(n.options.inline).to.be["false"],expect(n.options.toolbar).to.be["false"]})})}),describe("Editors stack",function(){it("Jodit.instances should contain all instances of Jodit",function(){var e=new Jodit(appendTestArea("textarea_editor"));expect(Jodit.instances.textarea_editor).to.equal(e)}),it("Jodit.instances should not contain editor after destruct",function(){new Jodit(appendTestArea("textarea_editor")).destruct(),expect(Jodit.instances.textarea_editor).to.be.an("undefined")})}),describe("Destructor",function(){it('After call "destruct" method, should return source textarea and remove Editor\'s stuf',function(){var e=appendTestArea();e.style.display="block";var t=new Jodit(e);expect(e.style.display).to.equal("none"),expect(t.container.parentNode).to.equal(e.parentNode),t.destruct(),expect(e.style.display).to.equal("block"),expect(t.editor).to.equal(undefined)}),it('After call "destruct" method, should return source textarea and remove all Editor\'s stuf',function(){var e=document.createElement("div"),t=document.createElement("textarea");e.appendChild(t),document.body.appendChild(e),new Jodit(t).destruct(),expect(e.innerHTML).to.equal("<textarea></textarea>"),e.parentNode.removeChild(e)})}),describe("Set/Get",function(){describe("Set value",function(){it("Set element value",function(){var e=appendTestArea();new Jodit(e).setElementValue("Test"),expect(e.value).to.be.equal("Test")}),it("Set value by magic property",function(){var e=appendTestArea(),t=new Jodit(e);t.value="Test",expect(e.value).to.be.equal("Test"),expect(t.getEditorValue()).to.be.equal("Test"),expect(t.value).to.be.equal("Test")})}),it("Set wrong element value",function(){var e=appendTestArea(),t=new Jodit(e);expect(function(){t.setElementValue(document.createTextNode("Test"))}).to["throw"](/value must be/)}),it("Set editor value",function(){var e=appendTestArea(),t=new Jodit(e);t.setEditorValue("<div>Test</div>"),expect(t.editor.innerHTML).to.be.equal("<div>Test</div>")}),it("Set no string editor value",function(){var e=appendTestArea(),t=new Jodit(e);expect(function(){t.setEditorValue(document.createElement("div"))}).to["throw"](/value must be/)}),it("Set wrong editor value",function(){var e=appendTestArea(),t=new Jodit(e);t.setEditorValue("<div>Test<div>"),expect(t.editor.innerHTML).to.be.equal("<div>Test<div></div></div>")}),describe("Placeholder",function(){describe("After init on empty textarea",function(){it("Should show placeholder",function(){var e=appendTestArea();e.value="";var t=new Jodit(e);expect(t.container.querySelectorAll(".jodit_placeholder").length&&"block"===t.container.querySelector(".jodit_placeholder").style.display).to.be.equal(!0)})}),describe("After init on not empty textarea",function(){it("Should hide placeholder",function(){var e=appendTestArea();e.value="111";var t=new Jodit(e);expect(t.container.querySelectorAll(".jodit_placeholder").length&&"none"===t.container.querySelector(".jodit_placeholder").style.display).to.be.equal(!0)})})}),it("Show placeholder",function(){var e=appendTestArea(),t=new Jodit(e);t.setEditorValue(""),expect(t.container.querySelectorAll(".jodit_placeholder").length&&"block"===t.container.querySelector(".jodit_placeholder").style.display).to.be.equal(!0),t.selection.insertNode(Jodit.modules.Dom.create("text","test",t.editorDocument)),expect(t.container.querySelectorAll(".jodit_placeholder").length&&"none"===t.container.querySelector(".jodit_placeholder").style.display).to.be.equal(!0)}),it("Placeholder's fontsize",function(){var e=appendTestArea(),t=new Jodit(e);t.editor.style.fontSize="12px",simulateEvent("keydown",Jodit.KEY_BACKSPACE,t.editor),expect(t.container.querySelectorAll(".jodit_placeholder").length&&"12px"===t.container.querySelector(".jodit_placeholder").style.fontSize).to.be.equal(!0)}),describe("Synchronization",function(){it("Check synchronization between element and editor",function(){var e=appendTestArea(),t=new Jodit(e);t.setEditorValue("<div>Test<div>");var o=window.getSelection(),n=document.createRange();n.selectNodeContents(t.editor.firstChild),n.collapse(!1),o.removeAllRanges(),o.addRange(n),expect(t.getElementValue()).to.be.equal("<div>Test<div></div></div>")}),it("Check synchronization between editor and element",function(){var e=appendTestArea(),t=new Jodit(e);e.value="<div>Test</div>",t.setElementValue(),expect(t.getEditorValue()).to.be.equal("<div>Test</div>")}),it("Check synchronization between editor and element with wrong html",function(){var e=appendTestArea(),t=new Jodit(e);t.setElementValue("<div>Test</div>"),expect(t.getEditorValue()).to.be.equal(t.getElementValue())}),it("Check synchronization between editor and element when was pressed button",function(){var e=appendTestArea(),t=new Jodit(e);t.setElementValue("<div>Test</div>"),expect(t.getEditorValue()).to.be.equal(t.getElementValue());var o=window.getSelection(),n=document.createRange();n.selectNodeContents(t.editor.firstChild),n.collapse(!1),o.removeAllRanges(),o.addRange(n),simulateEvent("keydown",Jodit.KEY_ENTER,t.editor),expect(t.getEditorValue()).to.be.equal(t.getElementValue())})}),describe("Save selection stuf",function(){describe("Set false in getEditorValue method",function(){it("Should return HTML with selections markers",function(){var e=new Jodit(appendTestArea());e.value="test",e.selection.setCursorAfter(e.editor.firstChild),e.selection.save(),expect(/<span[^>]+id="jodit_selection_marker_[^>]+><\/span>/.test(e.getEditorValue(!1))).to.be["true"],expect(/<span[^>]+id="jodit_selection_marker_[^>]+><\/span>/.test(e.getEditorValue(!0))).to.be["false"]})})}),describe("Change returning value",function(){describe('Event "beforeGetValueFromEditor"',function(){it("Should restore &gt; to normal value in Liquid expressions",function(){var e=new Jodit(appendTestArea());e.value="test {% if a > b %} stop {% if a < b %}",expect(e.value).to.be.equal("test {% if a &gt; b %} stop {% if a &lt; b %}"),e.events.on("beforeGetValueFromEditor",function(){return e.getNativeEditorValue().replace(/\{%[^\}]+%\}/g,function(e){return e.replace(/&gt;/g,">").replace(/&lt;/g,"<")})}),expect(e.value).to.be.equal("test {% if a > b %} stop {% if a < b %}")})}),describe('Event "beforeSetValueToEditor"',function(){it("Should be fired before set editor value",function(){var e=new Jodit(appendTestArea());e.value="test",expect(e.value).to.be.equal("test"),e.events.on("beforeSetValueToEditor",function(e){return e+" stop"}),e.value="test",expect(e.value).to.be.equal("test stop"),e.events.on("beforeSetValueToEditor",function(){return!1}),e.value="uuups",expect(e.value).to.be.equal("test stop")})})})}),describe("Selection module",function(){it("Current selection element should be inside editor",function(){var e=new Jodit(appendTestArea()),t=document.createElement("div");document.body.appendChild(t),t.innerHTML="jingl";var o=window.getSelection(),n=document.createRange();n.selectNodeContents(t),n.collapse(!1),o.removeAllRanges(),o.addRange(n),expect(e.selection.current()).to.be.equal(!1),t.parentNode.removeChild(t)}),it("Current selection element",function(){var e=new Jodit(appendTestArea()),t=e.editorDocument.createElement("div"),o=e.editorDocument.createTextNode("jingl");e.setEditorValue(""),t.appendChild(o),e.selection.insertNode(t),e.selection.setCursorIn(o),expect(e.selection.current()).to.be.equal(o)}),it("Insert simple text node in editor",function(){var e=appendTestArea(),t=new Jodit(e);t.selection.insertNode(t.editorDocument.createTextNode("Test")),expect(t.getEditorValue()).to.be.equal("Test"),t.destruct()}),it("Insert 3 divs",function(){function e(e){var t=o.editorDocument.createElement("div");t.innerHTML=e,o.selection.insertNode(t)}var t=appendTestArea(),o=new Jodit(t);e(1),e(2),e(3),expect(o.getEditorValue()).to.be.equal("<div>1</div><div>2</div><div>3</div>"),o.destruct()}),it("Insert wrong data",function(){var e=appendTestArea(),t=new Jodit(e);expect(function(){t.selection.insertNode()}).to["throw"](/node most be/),expect(function(){t.selection.insertNode("Text")}).to["throw"](/node most be/),expect(function(){t.selection.insertNode(null)}).to["throw"](/node most be/),t.destruct()}),it('Select all and delete. Check plugin "backspace"',function(){var e=appendTestArea(),t=new Jodit(e);t.setEditorValue("<p>asdasd</p><p>asdasd</p><p>asd</p>"),t.execCommand("selectall"),t.execCommand("delete"),expect(t.getEditorValue()).to.be.equal(""),t.destruct()}),describe("Cursor position",function(){it("Should set cursor after node",function(){var e=appendTestArea(),t=new Jodit(e,{cleanHTML:{removeEmptyElements:!1}}),o=[t.editorDocument.createElement("span"),t.editorDocument.createElement("span"),t.editorDocument.createElement("span")];t.selection.insertNode(o[0]),t.selection.insertNode(o[1]),t.selection.insertNode(o[2]),t.selection.setCursorAfter(o[1]),t.selection.insertNode(t.editorDocument.createElement("i")),expect(t.getEditorValue()).to.be.equal("<span></span><span></span><i></i><span></span>")}),it("Set cursor in non placed element",function(){var e=appendTestArea(),t=new Jodit(e);expect(function(){var e=t.editorDocument.createElement("div");t.selection.setCursorIn(e)}).to.Throw(/in editor/)})})}),afterEach(removeStuff)});