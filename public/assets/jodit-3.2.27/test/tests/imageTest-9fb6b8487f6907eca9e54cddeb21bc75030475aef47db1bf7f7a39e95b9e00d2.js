describe("Test image",function(){describe("Image properties dialog",function(){describe("Double click on image",function(){it("should open image properties dialog",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");expect(t).to.be.not.equal(null)}),describe("Disable by image.openOnDblClick",function(){it("should not open image properties dialog",function(){var e=new Jodit(appendTestArea(),{image:{openOnDblClick:!1}});e.setEditorValue('<img src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");expect(t).to.be.equal(null)})})}),describe("Change border radius",function(){it("should change image border radius",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img style="width:100px; height: 100px; border-radius: 10px;" src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");expect(t).to.be.not.equal(null),simulateEvent("mousedown",0,t.querySelectorAll(".jodit_tabs_buttons a")[1]);var o=t.querySelector(".jodit_tab.active");expect(o).to.be.not.equal(null),expect(o.querySelector(".border_radius")).to.be.not.equal(null),expect(o.querySelector(".border_radius").value.toString()).to.be.equal("10"),o.querySelector(".border_radius").value=100,simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<img src="tests/artio.jpg" style="border-radius:100px;height:100px;width:100px">')})}),describe("Change classes",function(){it("should change image classlist",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img class="images123" style="width:100px; height: 100px;" src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");expect(t).to.be.not.equal(null),simulateEvent("mousedown",0,t.querySelectorAll(".jodit_tabs_buttons a")[1]);var o=t.querySelector(".jodit_tab.active");expect(o).to.be.not.equal(null),expect(o.querySelector(".classes")).to.be.not.equal(null),expect(o.querySelector(".classes").value.toString()).to.be.equal("images123"),o.querySelector(".classes").value="tavble ",simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<img class="tavble " src="tests/artio.jpg" style="height:100px;width:100px">')})}),describe("Change styles",function(){it("should change image styles",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img style="padding:10px;width:100px; height: 100px;" src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");expect(t).to.be.not.equal(null),simulateEvent("mousedown",0,t.querySelectorAll(".jodit_tabs_buttons a")[1]);var o=t.querySelector(".jodit_tab.active");expect(o).to.be.not.equal(null),expect(o.querySelector(".style")).to.be.not.equal(null),expect(sortStyles(o.querySelector(".style").value.toString())).to.be.equal("height:100px;padding:10px;width:100px"),o.querySelector(".style").value="padding:20px;background-color: #ff0000;",simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<img src="tests/artio.jpg" style="background-color:#FF0000;height:100px;padding:20px;width:100px">')})}),describe("Change id",function(){it("should change image id",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img id="stop123"  style="width:100px; height: 100px;"  src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");expect(t).to.be.not.equal(null),simulateEvent("mousedown",0,t.querySelectorAll(".jodit_tabs_buttons a")[1]);var o=t.querySelector(".jodit_tab.active");expect(o).to.be.not.equal(null),expect(o.querySelector(".id")).to.be.not.equal(null),expect(o.querySelector(".id").value.toString()).to.be.equal("stop123"),o.querySelector(".id").value="fast12",simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<img id="fast12" src="tests/artio.jpg" style="height:100px;width:100px">')})}),describe("Change align",function(){describe("left",function(){it("should change image horizontal align",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img  style="width:100px; height: 100px;"  src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");simulateEvent("mousedown",0,t.querySelectorAll(".jodit_tabs_buttons a")[1]);var o=t.querySelector(".jodit_tab.active");expect(o).to.be.not.equal(null),expect(o.querySelector(".align")).to.be.not.equal(null),expect(o.querySelector(".align").value.toString()).to.be.equal(""),o.querySelector(".align").value="left",simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<img src="tests/artio.jpg" style="float:left;height:100px;width:100px">')})}),describe("right",function(){it("should change image horizontal align",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img  style="width:100px; height: 100px;"  src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");simulateEvent("mousedown",0,t.querySelectorAll(".jodit_tabs_buttons a")[1]);var o=t.querySelector(".jodit_tab.active");expect(o).to.be.not.equal(null),expect(o.querySelector(".align")).to.be.not.equal(null),expect(o.querySelector(".align").value.toString()).to.be.equal(""),o.querySelector(".align").value="right",simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<img src="tests/artio.jpg" style="float:right;height:100px;width:100px">')})}),describe("center",function(){it("should change image horizontal align",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img style="float:left;width:100px; height: 100px;" src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");simulateEvent("mousedown",0,t.querySelectorAll(".jodit_tabs_buttons a")[1]);var o=t.querySelector(".jodit_tab.active");expect(o).to.be.not.equal(null),expect(o.querySelector(".align")).to.be.not.equal(null),expect(o.querySelector(".align").value.toString()).to.be.equal("left"),o.querySelector(".align").value="center",simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<img src="tests/artio.jpg" style="display:block;height:100px;margin-left:auto;margin-right:auto;width:100px">')})}),describe("Clear align",function(){it("should clear some align",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img src="tests/artio.jpg" style="width:100px; height: 100px;display:block;margin-left:auto;margin-right:auto">'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");simulateEvent("mousedown",0,t.querySelectorAll(".jodit_tabs_buttons a")[1]);var o=t.querySelector(".jodit_tab.active");expect(o).to.be.not.equal(null),expect(o.querySelector(".align")).to.be.not.equal(null),expect(o.querySelector(".align").value.toString()).to.be.equal("center"),o.querySelector(".align").value="",simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<img src="tests/artio.jpg" style="height:100px;width:100px">')})})}),describe("Change margins",function(){describe("Change marginTop with lock",function(){it("should change all margins",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img style="margin: 10px;width:100px; height: 100px;" src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");simulateEvent("mousedown",0,t.querySelectorAll(".jodit_tabs_buttons a")[1]);var o=t.querySelector(".jodit_tab.active");expect(o.querySelector(".marginTop")).to.be.not.equal(null),expect(o.querySelector(".marginBottom")).to.be.not.equal(null),expect(o.querySelector(".marginTop").value.toString()).to.be.equal("10"),expect(o.querySelector(".marginBottom").hasAttribute("disabled")).to.be["true"],o.querySelector(".marginTop").value=100,simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<img src="tests/artio.jpg" style="height:100px;margin:100px;width:100px">')})}),describe("Change marginTop with unlock",function(){it("should change only marginTop",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img style="margin: 10px;width:100px; height: 100px;" src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");simulateEvent("mousedown",0,t.querySelectorAll(".jodit_tabs_buttons a")[1]);var o=t.querySelector(".jodit_tab.active"),i=o.querySelector(".jodit_lock_helper.jodit_lock_margin");expect(i).to.be.not.equal(null);var r=i.innerHTML;simulateEvent("click",0,i),expect(i.innerHTML).to.be.not.equal(r),expect(o.querySelector(".marginTop").value.toString()).to.be.equal("10"),expect(o.querySelector(".marginBottom").value.toString()).to.be.equal("10"),expect(o.querySelector(".marginLeft").value.toString()).to.be.equal("10"),expect(o.querySelector(".marginRight").value.toString()).to.be.equal("10"),expect(o.querySelector(".marginBottom").hasAttribute("disabled")).to.be["false"],o.querySelector(".marginTop").value=100,o.querySelector(".marginBottom").value=10,o.querySelector(".marginRight").value=20,o.querySelector(".marginLeft").value=220,simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<img src="tests/artio.jpg" style="height:100px;margin:100px 20px 10px 220px;width:100px">')})})}),describe("Change title",function(){it("should change image title",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img title="sting" style="width:100px; height: 100px;" src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]"),o=t.querySelector(".jodit_tab.active");expect(o).to.be.not.equal(null),expect(o.querySelector(".imageTitle")).to.be.not.equal(null),expect(o.querySelector(".imageTitle").value).to.be.equal("sting"),t.querySelector(".imageTitle").value="Stop",simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<img src="tests/artio.jpg" style="height:100px;width:100px" title="Stop">')})}),describe("Change alt",function(){it("should change image alt",function(e){var t=new Jodit(appendTestArea()),o=new Image,i=function(){t.value='<img alt="test" style="width:100px; height: 100px;" src="tests/artio.jpg"/>',simulateEvent("dblclick",0,t.editor.querySelector("img"));var o=t.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+t.id+"]"),i=o.querySelector(".jodit_tab.active");expect(i).to.be.not.equal(null),expect(i.querySelector(".imageAlt")).to.be.not.equal(null),expect(i.querySelector(".imageAlt").value).to.be.equal("test"),o.querySelector(".imageAlt").value="Stop",simulateEvent("click",0,o.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(t.value)).to.be.equal('<img alt="Stop" src="tests/artio.jpg" style="height:100px;width:100px">'),e()};o.src="tests/artio.jpg",o.complete?i():o.onload=i})}),describe("Change link",function(){it("should change image wrapper",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img  style="width:100px; height: 100px;"  src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]"),o=t.querySelector(".jodit_tab.active");expect(o).to.be.not.equal(null),expect(o.querySelector(".imageLink")).to.be.not.equal(null),expect(o.querySelector(".imageLink").value).to.be.equal(""),t.querySelector(".imageLink").value="https://xdsoft.net/",simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<a href="https://xdsoft.net/"><img src="tests/artio.jpg" style="height:100px;width:100px"></a>')}),describe("open link in new tab",function(){it('should change image wrapper with target="_blank"',function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img style="width:100px; height: 100px;" src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]"),o=t.querySelector(".jodit_tab.active");expect(o).to.be.not.equal(null),expect(o.querySelector(".imageLink")).to.be.not.equal(null),expect(o.querySelector(".imageLink").value).to.be.equal(""),t.querySelector(".imageLink").value="https://xdsoft.net/",t.querySelector(".imageLinkOpenInNewTab").checked=!0,simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<a href="https://xdsoft.net/" target="_blank"><img src="tests/artio.jpg" style="height:100px;width:100px"></a>')})}),describe("Open dialog dor image wrapped in link",function(){it("should change image wrapper",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<a href="https://xdan.ru" target="_blank"><img  style="width:100px; height: 100px;"  src="tests/artio.jpg"/></a>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]"),o=t.querySelector(".jodit_tab.active");expect(o).to.be.not.equal(null),expect(o.querySelector(".imageLink")).to.be.not.equal(null),expect(o.querySelector(".imageLink").value).to.be.equal("https://xdan.ru"),expect(o.querySelector(".imageLinkOpenInNewTab").checked).to.be["true"],t.querySelector(".imageLink").value="https://xdsoft.net/",t.querySelector(".imageLinkOpenInNewTab").checked=!1,simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<a href="https://xdsoft.net/"><img src="tests/artio.jpg" style="height:100px;width:100px"></a>')})}),describe("Unlink",function(){it("should remove image wrapper",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<a href="https://xdan.ru" target="_blank"><img style="width:100px; height: 100px;" src="tests/artio.jpg"/></a>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]"),o=t.querySelector(".jodit_tab.active");expect(o).to.be.not.equal(null),expect(o.querySelector(".imageLink")).to.be.not.equal(null),expect(o.querySelector(".imageLink").value).to.be.equal("https://xdan.ru"),expect(o.querySelector(".imageLinkOpenInNewTab").checked).to.be["true"],t.querySelector(".imageLink").value="",t.querySelector(".imageLinkOpenInNewTab").checked=!1,simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(e.value)).to.be.equal('<img src="tests/artio.jpg" style="height:100px;width:100px">')})})}),describe("Change size functionality",function(){it("should create connected inputs with width and height",function(e){function t(){simulateEvent("dblclick",0,o.editor.querySelector("img"));var t=o.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+o.id+"]"),r=t.querySelector(".imageWidth"),l=t.querySelector(".imageHeight");expect(r).to.be.not.equal(null),expect(l).to.be.not.equal(null),expect(r.value).to.be.equal(i.offsetWidth.toString()),expect(l.value).to.be.equal(i.offsetHeight.toString()),r.value=100,simulateEvent("change",0,r),expect(l.value).to.be.not.equal(i.offsetHeight.toString()),l.value=200,simulateEvent("change",0,l),expect(r.value).to.be.not.equal("100"),simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(o.value)).to.be.equal('<img src="tests/artio.jpg" style="height:200px;width:356px">'),e()}var o=new Jodit(appendTestArea());o.value='<img src="tests/artio.jpg"/>';var i=o.editor.querySelector("img");i.complete?t():i.onload=t}),describe("unlock ratio",function(){it("should create connected inputs with width and height",function(e){function t(){simulateEvent("dblclick",0,o.editor.querySelector("img"));var t=o.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+o.id+"]"),r=t.querySelector(".imageWidth"),l=t.querySelector(".imageHeight"),a=t.querySelector(".jodit_lock_helper.jodit_lock_size");expect(a).to.be.not.equal(null),expect(r).to.be.not.equal(null),expect(l).to.be.not.equal(null),expect(r.value).to.be.equal(i.offsetWidth.toString()),expect(l.value).to.be.equal(i.offsetHeight.toString()),simulateEvent("click",0,a),r.value=100,simulateEvent("change",0,r),expect(l.value).to.be.equal(i.offsetHeight.toString()),l.value=200,simulateEvent("change",0,l),expect(r.value).to.be.equal("100"),simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(o.value)).to.be.equal('<img src="tests/artio.jpg" style="height:200px;width:100px">'),e()}var o=new Jodit(appendTestArea());o.value='<img src="tests/artio.jpg"/>';var i=o.editor.querySelector("img");i.complete?t():i.onload=t}),describe("Toggle ratio again",function(){it("should create connected inputs with width and height",function(e){function t(){simulateEvent("dblclick",0,o.editor.querySelector("img"));var t=o.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+o.id+"]"),r=t.querySelector(".imageWidth"),l=t.querySelector(".imageHeight"),a=t.querySelector(".jodit_lock_helper.jodit_lock_size"),n=a.innerHTML;simulateEvent("click",0,a),expect(a.innerHTML).to.be.not.equal(n),simulateEvent("click",0,a),expect(a.innerHTML).to.be.equal(n),r.value=100,simulateEvent("change",0,r),expect(l.value).to.be.not.equal(i.offsetHeight.toString()),l.value=200,simulateEvent("change",0,l),expect(r.value).to.be.not.equal("100"),simulateEvent("click",0,t.querySelectorAll(".jodit_dialog_footer a.jodit_button")[0]),expect(sortAtrtibutes(o.value)).to.be.equal('<img src="tests/artio.jpg" style="height:200px;width:356px">'),e()}var o=new Jodit(appendTestArea());o.value='<img src="tests/artio.jpg"/>';var i=o.editor.querySelector("img");i.complete?t():i.onload=t})})})}),describe("Show filebrowser buttons and edit image button",function(){describe("If uploader or filebrowser settings don't setted",function(){it("should not show buttons",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");expect(t).to.be.not.equal(null),expect(t.querySelector(".jodit_button.jodit_rechange")).to.be.equal(null),expect(t.querySelector(".jodit_button.jodit_use_image_editor")).to.be.equal(null)})}),describe("Uploader and filebrowser settings set",function(){var e={uploader:{url:"https://xdsoft.net/jodit/connector/index.php?action=fileUpload"},filebrowser:{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}}};it("should not show buttons",function(){var t=new Jodit(appendTestArea(),e);t.setEditorValue('<img src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,t.editor.querySelector("img"));var o=t.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+t.id+"]");expect(o.querySelector(".jodit_button.jodit_rechange")).to.be.not.equal(null),expect(o.querySelector(".jodit_button.jodit_use_image_editor")).to.be.not.equal(null)}),describe("Click on filebrowser button",function(){it("should open popup",function(){var t=new Jodit(appendTestArea(),e);t.setEditorValue('<img src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,t.editor.querySelector("img"));var o=t.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+t.id+"]"),i=o.querySelector(".jodit_button.jodit_rechange");expect(i).to.be.not.equal(null),simulateEvent("mousedown",0,i),expect(o.querySelector(".jodit_toolbar_popup.jodit_toolbar_popup-open.jodit_right")).to.be.not.equal(null)})}),describe("Click on edit button",function(){describe("When photo it is not my",function(){it("should open image editor",function(t){var o=new Jodit(appendTestArea(),e);o.value='<img src="https://xdsoft.net/jodit/build/images/artio.jpg"/>',simulateEvent("dblclick",0,o.editor.querySelector("img"));var i=o.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+o.id+"]");expect(i).to.be.not["null"];var r=i.querySelector(".jodit_button.jodit_use_image_editor");expect(r).to.be.not["null"],simulateEvent("mousedown",0,r);var l=o.ownerDocument.querySelector(".jodit.jodit_dialog_box.active.jodit_modal");expect(l).to.be.not.equal(null),expect(l).to.be.not.equal(i),simulateEvent("click",0,l.querySelector("a.jodit_button"));var a=o.ownerDocument.querySelector(".jodit.jodit_dialog_box.active.jodit_modal");expect(a).to.be.not.equal(null),expect(a).to.be.not.equal(l),simulateEvent("click",0,a.querySelector("a.jodit_button"));var n=o.ownerDocument.querySelector(".jodit.jodit_dialog_box.active.jodit_modal");expect(n).to.be.not.equal(null),expect(n).to.be.not.equal(a),simulateEvent("click",0,n.querySelector("a.jodit_button")),expect(i.querySelector(".imageSrc").value).to.be.equal("https://xdsoft.net/jodit/files/artio.jpg"),t()})})})})})}),it("Double click on image then openOnDblClick=false should select image",function(){var e=new Jodit(appendTestArea(),{image:{openOnDblClick:!1}});e.setEditorValue('<img src="tests/artio.jpg"/>'),simulateEvent("dblclick",0,e.editor.querySelector("img"));var t=document.querySelectorAll(".jodit.jodit_dialog_box.active");expect(t.length).to.equal(0),expect(e.selection.current().tagName).to.equal("IMG")}),describe("One click on image",function(){it("should show resizer",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<img src="tests/artio.jpg"/>');var t=e.editor.querySelector("img");simulateEvent("mousedown",0,t);var o=document.querySelector(".jodit_resizer[data-editor_id="+e.id+"]");expect("block"===o.style.display).to.equal(!0)}),describe("in full size mode",function(){it("should show resizer and set mmaximum zIndex",function(){var e=new Jodit(appendTestArea(),{fullsize:!0});e.value='<img src="tests/artio.jpg"/>';var t=e.editor.querySelector("img");simulateEvent("mousedown",0,t);var o=document.querySelector(".jodit_resizer[data-editor_id="+e.id+"]");expect(o.style.display).to.be.equal("block"),expect(o.style.zIndex).to.be.equal(window.getComputedStyle(e.container).zIndex)})})}),it("One click inside table cell should show resizer",function(){var e=new Jodit(appendTestArea());e.setEditorValue("<table><tr><td>1</td></tr></table>");var t=e.editor.querySelector("td");simulateEvent("mousedown",0,t);var o=document.querySelector(".jodit_resizer[data-editor_id="+e.id+"]");expect("block"===o.style.display).to.equal(!0)}),describe("Popup box",function(){describe("In relative object",function(){it("should be under image",function(){var e=document.createElement("div");e.innerHTML='<div style="width:800px; margin:auto; border:1px solid red;">\n        wrong image selection\n        <div style="position:relative;text-align: left">\n            <textarea id="text_area0"> <img src="https://xdsoft.net/jodit/build/images/artio.jpg" style="border:1px solid red;width:100px;height:100px;"/></textarea>\n        </div>\n    </div>',document.body.appendChild(e);var t=new Jodit("#text_area0",{observer:{timeout:0}});window.scrollTo(0,offset(e).top),simulateEvent("mousedown",0,t.editor.querySelector("img"));var o=document.querySelector(".jodit_toolbar_popup-inline[data-editor_id=text_area0]");expect(null!==o.parentNode.parentNode).to.equal(!0);var i=offset(o.parentNode),r=offset(t.editor.querySelector("img"));expect(Math.abs(i.left-(r.left+r.width/2))<20).to.be["true"],expect(Math.abs(i.top-(r.top+r.height))<20).to.be["true"],t.destruct(),document.body.removeChild(e)})})}),describe("Resize box",function(){describe("In relative object",function(){it("should be in front of image",function(){var e=document.createElement("div");e.innerHTML='<div style="width:800px; margin:auto; border:1px solid red;">\n        wrong image selection\n        <div style="position:relative;text-align: left">\n            <textarea id="text_area0"> <img src="https://xdsoft.net/jodit/build/images/artio.jpg" style="border:1px solid red;width:100px;height:100px;"/></textarea>\n        </div>\n    </div>',document.body.appendChild(e);var t=new Jodit("#text_area0");simulateEvent("mousedown",0,t.editor.querySelector("img"));var o=document.querySelector(".jodit_resizer[data-editor_id=text_area0]");expect("block"===o.style.display).to.equal(!0);var i=offset(o),r=offset(t.editor.querySelector("img"));expect(Math.abs(i.left-r.left)<2).to.be["true"],expect(Math.abs(i.top-r.top)<2).to.be["true"],t.destruct(),document.body.removeChild(e)})}),describe("After resize - popup",function(){it("should be hidden and after this should be shown",function(){var e=document.createElement("div");e.innerHTML='<div style="width:800px; margin:auto; border:1px solid red;">\n        wrong image selection\n        <div style="position:relative;text-align: left">\n            <textarea id="text_area1"> &lt;img src="https://xdsoft.net/jodit/build/images/artio.jpg" style="border:1px solid red;width:100px;height:100px;"/&gt;</textarea>\n        </div>\n    </div>',document.body.appendChild(e);var t=new Jodit(document.getElementById("text_area1"));simulateEvent("mousedown",0,t.editor.querySelector("img"));var o=t.ownerDocument.querySelector(".jodit_toolbar_popup-inline[data-editor_id=text_area1]");expect(null!==o.parentNode.parentNode).to.equal(!0);var i=t.ownerDocument.querySelector(".jodit_resizer[data-editor_id=text_area1]");expect("block"===i.style.display).to.equal(!0);var r=offset(i);simulateEvent("mousedown",0,i.getElementsByTagName("i")[0]),simulateEvent("mousemove",0,t.ownerWindow,function(e){e.clientX=r.left-10,e.clientY=r.top-10}),expect(o.parentNode).to.be.equal(null),simulateEvent("mouseup",0,t.ownerWindow,function(e){e.clientX=r.left-10,e.clientY=r.top-10}),expect(o.parentNode).to.be.equal(null),t.destruct(),e.parentNode&&e.parentNode.removeChild(e)})}),describe("Resize image",function(){describe("Size box",function(){it("Should show size for image",function(e){var t=new Jodit(appendTestArea(),{observer:{timeout:0},resizer:{hideSizeTimeout:400}});t.value='<img src="tests/artio.jpg" style="width:500px;height: 281px;"/>',simulateEvent("mousedown",0,t.editor.querySelector("img"));var o=document.querySelector(".jodit_resizer[data-editor_id="+t.id+"]");expect(o).to.be.not["null"];var i=o.querySelector("span");expect(i).to.be.not["null"],expect(t.ownerWindow.getComputedStyle(i).opacity).to.be.equal("0");var r=offset(o);simulateEvent("mousedown",0,o.getElementsByTagName("i")[1]),simulateEvent("mousemove",0,t.ownerWindow,function(e){e.clientX=r.left+10,e.clientY=r.top+10}),simulateEvent("mouseup",0,t.ownerWindow,function(e){e.clientX=r.left+10,e.clientY=r.top+10}),expect(i.style.opacity).to.be.equal("1"),setTimeout(function(){expect(i.style.opacity).to.be.equal("0"),e()},500)}),describe("For small state",function(){it("Should hide size",function(){var e=new Jodit(appendTestArea(),{observer:{timeout:0},resizer:{hideSizeTimeout:400}});e.value='<img src="tests/artio.jpg" style="width:500px;height: 281px;"/>',simulateEvent("mousedown",0,e.editor.querySelector("img"));var t=document.querySelector(".jodit_resizer[data-editor_id="+e.id+"]");expect(t).to.be.not["null"];var o=t.querySelector("span");expect(o).to.be.not["null"],expect(e.ownerWindow.getComputedStyle(o).opacity).to.be.equal("0");var i=offset(t);simulateEvent("mousedown",0,t.getElementsByTagName("i")[1]),simulateEvent("mousemove",0,e.ownerWindow,function(e){e.clientX=i.left-480,e.clientY=i.top-200}),simulateEvent("mouseup",0,e.ownerWindow,function(e){e.clientX=i.left-480,e.clientY=i.top-200}),expect(o.style.opacity).to.be.equal("0")})})}),it("Should not allow to resize image more then width of editor",function(e){box.style.width="600px";var t=new Jodit(appendTestArea()),o=new Image;o.src="tests/artio.jpg";var i=function(){var i=o.naturalWidth/o.naturalHeight;t.value='<img src="tests/artio.jpg" style="width:500px;height: 281px;"/>';var r=t.editor.querySelector("img");simulateEvent("mousedown",0,t.editor.querySelector("img"));var l=document.querySelector(".jodit_resizer[data-editor_id="+t.id+"]");expect(l).to.be.not["null"];var a=offset(l);simulateEvent("mousedown",0,l.getElementsByTagName("i")[1]),simulateEvent("mousemove",0,t.ownerWindow,function(e){e.clientX=a.left+1e3,e.clientY=a.top+1e3}),simulateEvent("mouseup",0,t.ownerWindow,function(e){e.clientX=a.left+1e3,e.clientY=a.top+1e3});var n=r.offsetWidth/r.offsetHeight;expect(r.offsetWidth).to.be.equal(t.editor.offsetWidth-20),expect(Math.abs(n-i)<.003).to.be["true"],e()};o.complete?i():o.onload=i})})}),afterEach(removeStuff)});