describe("CodeMirror editor source code",function(){describe("Init",function(){it("After init container must has codeeditor container",function(e){var t,o=appendTestArea(!1,!0),n=function(){clearTimeout(t),this.events.off("beforeDestruct"),this.destruct(),o.parentNode.removeChild(o),e()};t=setTimeout(function(){expect(!1).to.equal(!0),n.call(editor)},5e3),editor=new Jodit(o,{defaultMode:Jodit.MODE_SOURCE,useAceEditor:!0,events:{beforeDestruct:function(){return!1},aceInited:function(e){expect(e.container.querySelectorAll(".jodit_source_mirror-fake").length).to.equal(1),n.call(e)}}})}).timeout(6e3)}),describe("Change mode",function(){describe("In WYSIWYG mode isEditorMode",function(){it("Should return true",function(){var e=new Jodit(appendTestArea());expect(e.isEditorMode()).to.be["true"],e.toggleMode(),expect(e.isEditorMode()).to.be["false"]})}),it("Should not fire Change event",function(){var e=new Jodit(appendTestArea(),{useAceEditor:!1}),t="test",o=0;e.value=t,e.events.on("change",function(e,n){expect(n).to.be.not.equal(e),expect(t).to.be.not.equal(e),o++}),e.selection.setCursorAfter(e.editor.firstChild),e.setMode(Jodit.MODE_SOURCE),e.setMode(Jodit.MODE_WYSIWYG),e.value=t,e.value="another",expect(1).to.be.equal(o)}),describe("After change mode to source mode and use insertHTML method",function(){it("Should insert text on caret position",function(e){new Jodit(appendTestArea(),{useAceEditor:!0,beautifyHTML:!1,events:{aceInited:function(t){t.value="<p>test <span>test</span> test</p>";var o=t.editorDocument.createRange();o.selectNodeContents(t.editor.querySelector("span")),o.collapse(!1),t.selection.selectRange(o),t.setMode(Jodit.MODE_SOURCE),t.selection.insertHTML("loop"),expect(t.value).to.be.equal("<p>test <span>testloop</span> test</p>"),e()}}})}).timeout(4e3),describe("Without ace",function(){it("Should insert text on caret position",function(){var e=new Jodit(appendTestArea(),{useAceEditor:!1});e.value="<p>one <span>two</span> three</p>";var t=e.editorDocument.createRange();t.selectNodeContents(e.editor.querySelector("span")),t.collapse(!1),e.selection.selectRange(t),e.selection.insertHTML("stop"),expect(e.value).to.be.equal("<p>one <span>twostop</span> three</p>"),e.setMode(Jodit.MODE_SOURCE),e.selection.insertHTML("loop"),expect(e.value).to.be.equal("<p>one <span>twostoploop</span> three</p>")})})})}),afterEach(removeStuff)});