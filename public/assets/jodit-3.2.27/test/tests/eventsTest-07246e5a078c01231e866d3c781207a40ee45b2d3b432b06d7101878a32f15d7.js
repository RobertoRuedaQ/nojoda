describe("Jodit Events system Tests",function(){describe("Native Events",function(){it("Create simple event handler on some DOM element",function(){var e=new Jodit(appendTestArea()),t=!1,n=document.createElement("button");document.body.appendChild(n),e.events.on(n,"click",function(){t=!0}),simulateEvent("click",0,n),expect(t).to.be.equal(!0),n.parentNode.removeChild(n)}),it("Create simple event handler on some DOM element on few events",function(){var e=new Jodit(appendTestArea()),t=0,n=document.createElement("button");document.body.appendChild(n),e.events.on(n,"click dblclick keydown",function(){t++}),simulateEvent("click",0,n),simulateEvent("dblclick",0,n),simulateEvent("keydown",0,n),expect(t).to.be.equal(3),n.parentNode.removeChild(n)}),it("Create simple event handler on all DOM elements which will be inside some starting DOm element",function(){var e=new Jodit(appendTestArea()),t=0,n=document.createElement("button"),o=document.createElement("a");document.body.appendChild(n),e.events.on(n,"click",function(){t++},"a.active"),simulateEvent("click",0,n),expect(t).to.be.equal(0),n.appendChild(o),simulateEvent("click",0,o),expect(t).to.be.equal(0),o.classList.add("active"),simulateEvent("click",0,o),expect(t).to.be.equal(1),n.parentNode.removeChild(n)}),it("Add and remove event handler",function(){var e=new Jodit(appendTestArea()),t=0,n=document.createElement("button");document.body.appendChild(n),e.events.on(n,"click",function(){t++}),simulateEvent("click",0,n),expect(t).to.be.equal(1),e.events.off(n,"click"),simulateEvent("click",0,n),expect(t).to.be.equal(1),n.parentNode.removeChild(n)}),describe("Add a few handlers for several evens and remove all handlers",function(){it("Should stop listening events",function(){var e=new Jodit(appendTestArea()),t=0,n=document.createElement("button");document.body.appendChild(n),e.events.on(n,"click",function(){t++}),e.events.on(n,"dblclick",function(){t++}),e.events.on(n,"mousedown",function(){t++}),simulateEvent("click",0,n),simulateEvent("dblclick",0,n),simulateEvent("mousedown",0,n),expect(t).to.be.equal(3),e.events.off(n),simulateEvent("click",0,n),simulateEvent("dblclick",0,n),simulateEvent("mousedown",0,n),expect(t).to.be.equal(3),n.parentNode.removeChild(n)})}),it("Add event handler for several elements",function(){var e=new Jodit(appendTestArea()),t="",n=e.editorDocument.createElement("button"),o=e.editorDocument.createElement("button");e.editorDocument.body.appendChild(n),e.editorDocument.body.appendChild(o),n.innerText="test1",o.innerText="test2",e.events.on([n,o],"click",function(){t+=this.innerText}).fire(n,"click"),e.events.fire(o,"click"),expect(t).to.be.equal("test1test2"),n.parentNode.removeChild(n),o.parentNode.removeChild(o)}),it("Fire trigger",function(){var e=new Jodit(appendTestArea()),t=0,n=document.createElement("button");document.body.appendChild(n),e.events.on(n,"click",function(){t++}).fire(n,"click"),expect(t).to.be.equal(1),n.parentNode.removeChild(n)}),describe("Remove handler",function(){it("should remove full handler with selector options",function(){var e=new Jodit(appendTestArea()),t=0,n=document.createElement("a"),o=document.createElement("button");n.innerText="test",o.appendChild(n),document.body.appendChild(o),e.events.on(o,"click",function(){t++},"a").fire(o,"click"),expect(t).to.be.equal(0),e.events.fire(n,"click"),expect(t).to.be.equal(1),e.events.off(o,"click"),e.events.fire(n,"click"),expect(t).to.be.equal(1),e.events.on(o,"click",function(){t++},"a"),e.events.fire(n,"click"),expect(t).to.be.equal(2),o.parentNode.removeChild(o)})}),describe("Remove all handlers using event namespace",function(){it("Should Remove all handlers",function(){var e=new Jodit(appendTestArea()),t=0,n=document.createElement("button"),o=function(){t++};document.body.appendChild(n),e.events.on(n,"click",o),e.events.on(n,"mousedown",o),e.events.on(n,"click.test",o),e.events.on(n,"mousedown.test",o),e.events.fire(n,"click"),e.events.fire(n,"mousedown"),expect(t).to.be.equal(4),e.events.fire(n,"click.test"),e.events.fire(n,"mousedown.test"),expect(t).to.be.equal(8),e.events.off(n,".test"),e.events.fire(n,"click"),e.events.fire(n,"mousedown"),expect(t).to.be.equal(10),n.parentNode.removeChild(n)})}),it("Proxy event from iframe.window to main.window",function(){var e=new Jodit(appendTestArea(),{iframe:!0}),t=0,n=function(){t++};window.addEventListener("mousedown",n),e.events.fire(e.editorWindow,"mousedown"),expect(t).to.be.equal(1),window.removeEventListener("mousedown",n)})}),describe("Jodit Events",function(){it("Event handler",function(){var e=!1,t=new Jodit(appendTestArea());t.events.on("keydown",function(){e=!0}),simulateEvent("keydown",Jodit.KEY_ENTER,t.editor),expect(e).to.be.equal(!0)}),it("Delete event handler",function(){var e=!1,t=function(){e=!0},n=new Jodit(appendTestArea());n.events.on("keydown",t),n.events.off("keydown",t),simulateEvent("keydown",Jodit.KEY_Y,n.editor),expect(e).to.be.equal(!1)}),it("Proxy events",function(){var e=new Jodit(appendTestArea()),t=!1;e.events.on("keydown",function(){t=!0}),simulateEvent("keydown",Jodit.KEY_ENTER,e.editor),expect(t).to.be.equal(!0)})}),describe("Combine events",function(){describe("Pass arguments in handler",function(){it("Should pass all Fire arguments in handler",function(){var e=new Jodit.modules.EventsNative,t={},n=0;e.on(t,"click",function(e){n+=e}),e.fire(t,"click",1),e.fire(t,"click",2),e.fire(t,"click",3),expect(6).to.be.equal(n)})}),describe("Queue operations",function(){it("Should call handlers in order how the were added but handler with onTop option should be called first",function(){var e=new Jodit.modules.EventsNative,t={},n=[];e.on(t,"click",function(){n.push(1)}),e.on(t,"click",function(){n.push(2)}),e.on(t,"click",function(){n.push(3)}),e.on(t,"click",function(){n.push(4)},undefined,!0),e.fire(t,"click"),expect("4,1,2,3").to.be.equal(n.toString())}),describe("Stop propagation",function(){it("Should stop all calls for this event but another events should be called",function(){var e=new Jodit.modules.EventsNative,t={},n=[];e.on(t,"lope",function(){n.push(15)}),e.on(t,"pop",function(){n.push(16)}),e.on(t,"click",function(){n.push(1)}),e.on(t,"click",function(){n.push(2),e.fire(t,"pop"),e.stopPropagation(t,"click"),e.fire(t,"lope")}),e.on(t,"click",function(){n.push(3)}),e.on(t,"click",function(){n.push(4)},undefined,!0),e.fire(t,"click"),e.fire(t,"click"),expect("4,1,2,16,15,4,1,2,16,15").to.be.equal(n.toString())}),describe("Default object",function(){it("Should stop all calls for this event but another events should be called",function(){var e=new Jodit.modules.EventsNative,t=[];e.on("lope",function(){t.push(15)}),e.on("pop",function(){t.push(16)}),e.on("click",function(){t.push(1)}),e.on("click",function(){t.push(2),e.fire("pop"),e.stopPropagation("click"),e.fire("lope")}),e.on("click",function(){t.push(3)}),e.on("click",function(){t.push(4)},undefined,undefined,!0),e.fire("click"),e.fire("click"),expect("4,1,2,16,15,4,1,2,16,15").to.be.equal(t.toString())})})})}),describe("Short form",function(){describe("Add event to simple object",function(){it("Should work with on handler",function(){var e=new Jodit.modules.EventsNative,t=!1;e.on("click",function(){t=!0}),e.fire("click"),expect(!0).to.be.equal(t)}),describe("Namespaces",function(){describe("Add handler with namespace",function(){describe("Remove event listener without namespace",function(){it("Should remove handler with namespace",function(){var e=new Jodit.modules.EventsNative,t=0,n=function(){t+=1};e.on("click.jodit",n),e.fire("click"),e.fire("click.jodit"),expect(2).to.be.equal(t),e.off("click"),e.fire("click.jodit"),e.fire("click"),expect(2).to.be.equal(t)})}),describe("Remove event listener with namespace",function(){it("Should remove handler with namespace",function(){var e=new Jodit.modules.EventsNative,t=0,n=function(){t+=1};e.on("click.jodit",n),e.fire("click"),e.fire("click.jodit"),expect(2).to.be.equal(t),e.off("click.jodit"),e.fire("click.jodit"),e.fire("click"),expect(2).to.be.equal(t)})})}),describe("Add handlers with and without namespace",function(){describe("And fire without namespace",function(){it("Should fire both handlers",function(){var e=new Jodit.modules.EventsNative,t=0,n=function(){t+=1};e.on("click",n),e.on("click.jodit",n),e.fire("click"),expect(2).to.be.equal(t)})}),describe("And fire with namespace",function(){it("Should fire only one handler with namespace",function(){var e=new Jodit.modules.EventsNative,t=0,n=function(){t+=1};e.on("click",n),e.on("click.jodit",n),e.fire("click.jodit"),expect(1).to.be.equal(t)})}),describe("Remove event listeners",function(){describe("Remove event listener with namespace",function(){it("Should remove handler only with namespace",function(){var e=new Jodit.modules.EventsNative,t=0,n=function(){t+=1};e.on("click",n),e.on("click.jodit",n),e.fire("click"),expect(2).to.be.equal(t),e.off("click.jodit"),e.fire("click.jodit"),e.fire("click"),expect(3).to.be.equal(t)})}),describe("Remove event listener without namespace",function(){it("Should remove all handlers",function(){var e=new Jodit.modules.EventsNative,t=0,n=function(){t+=1};e.on("click",n),e.on("click.jodit",n),e.fire("click"),expect(2).to.be.equal(t),e.off("click"),e.fire("click.jodit"),e.fire("click"),expect(2).to.be.equal(t)})})})})})})}),describe("Return value",function(){it("Should return last not undefined value from fire",function(){var e=new Jodit.modules.EventsNative,t={},n=0;e.on(t,"click",function(){return 50}),e.on(t,"click",function(){return 60}),e.on(t,"click",function(){}),n=e.fire(t,"click"),expect(60).to.be.equal(n)})}),describe("Add event to simple object",function(){it("Should work with on handler",function(){var e=new Jodit.modules.EventsNative,t={},n=!1;e.on(t,"click",function(){n=!0}),e.fire(t,"click"),expect(!0).to.be.equal(n)}),it("Should work with several handlers",function(){var e=new Jodit.modules.EventsNative,t={},n=[];e.on(t,"click",function(){n.push(1)}),e.on(t,"click",function(){n.push(2)}),e.fire(t,"click"),expect("1,2").to.be.equal(n.toString())}),describe("Add event to simple object with namespace",function(){describe("Fire event",function(){it("Should work with namespace and without namespace",function(){var e=new Jodit.modules.EventsNative,t={},n=0;e.on(t,"click.jodit",function(){n+=1}),e.fire(t,"click.jodit"),e.fire(t,"click"),e.fire(t,"click.test"),expect(2).to.be.equal(n)}),it("Should work only for current object",function(){var e=new Jodit.modules.EventsNative,t={},n={},o=0;e.on(t,"click.jodit",function(){o+=1}),e.fire(t,"click.jodit"),e.fire(n,"click"),expect(1).to.be.equal(o)})}),describe("Remove event listener",function(){it("Should remove handler without namespace",function(){var e=new Jodit.modules.EventsNative,t={},n=0,o=function(){n+=1};e.on(t,"click.jodit",o),e.fire(t,"click"),expect(1).to.be.equal(n),e.off(t,"click.jodit"),e.fire(t,"click.jodit"),e.fire(t,"click"),expect(1).to.be.equal(n)}),it("Should remove handler  with namespace",function(){var e=new Jodit.modules.EventsNative,t={},n=0,o=function(){n+=1};e.on(t,"click",o),e.fire(t,"click"),expect(1).to.be.equal(n),e.off(t,"click.jodit"),e.fire(t,"click.jodit"),e.fire(t,"click"),expect(2).to.be.equal(n)}),describe("with namespace",function(){it("Should remove handler with namespace only for one event",function(){var e=new Jodit.modules.EventsNative,t={},n=[],o=function(){n.push(1)};e.on(t,"click.jodit mousedown.jodit",o),e.on(t,"mousedown",function(){n.push(2)}),e.fire(t,"click"),expect("1").to.be.equal(n.toString()),e.off(t,"click.jodit"),e.fire(t,"click.jodit"),e.fire(t,"click"),expect("1").to.be.equal(n.toString()),e.fire(t,"mousedown"),expect("1,2,1").to.be.equal(n.toString()),e.off(t,"mousedown"),e.fire(t,"mousedown"),expect("1,2,1").to.be.equal(n.toString())})}),describe("Remove event listener for specific handler",function(){it("Should remove only specific handler",function(){var e=new Jodit.modules.EventsNative,t={},n=[],o=function(){n.push(2)},i=function(){n.push(1)};e.on(t,"click.jodit",i),e.on(t,"click",o),e.fire(t,"click"),expect("2,1").to.be.equal(n.toString()),e.off(t,"click.jodit",i),e.off(t,"click.jodit",o),e.fire(t,"click.jodit"),e.fire(t,"click"),expect("2,1,2").to.be.equal(n.toString()),e.off(t,"click",o),e.fire(t,"click.jodit"),e.fire(t,"click"),expect("2,1,2").to.be.equal(n.toString())})}),describe("Remove event listener for whole namespace",function(){it("Should remove all handlers from namespace",function(){var e=new Jodit.modules.EventsNative,t={},n=0,o=function(){n+=1};e.on(t,"click.jodit",o),e.on(t,"mousedown.jodit",o),e.fire(t,"click mousedown"),expect(2).to.be.equal(n),e.off(t,".jodit"),e.fire(t,"click"),e.fire(t,"mousedown"),expect(2).to.be.equal(n)})})})})}),describe("Native Events",function(){it("Create simple event handler on some DOM element",function(){var e=new Jodit.modules.EventsNative,t=!1,n=document.createElement("button");document.body.appendChild(n),e.on(n,"click",function(){t=!0}),simulateEvent("click",0,n),expect(t).to.be.equal(!0),n.parentNode.removeChild(n)}),it("Create simple event handler on some DOM element on few events",function(){var e=new Jodit.modules.EventsNative,t=0,n=document.createElement("button");document.body.appendChild(n),e.on(n,"click dblclick keydown",function(){t++}),simulateEvent("click",0,n),simulateEvent("dblclick",0,n),simulateEvent("keydown",0,n),expect(t).to.be.equal(3),n.parentNode.removeChild(n)}),it("Create simple event handler on all DOM elements which will be inside some starting DOm element",function(){var e=new Jodit.modules.EventsNative,t=0,n=document.createElement("button"),o=document.createElement("a");document.body.appendChild(n),e.on(n,"click",function(){t++},"a.active"),simulateEvent("click",0,n),expect(t).to.be.equal(0),n.appendChild(o),simulateEvent("click",0,o),expect(t).to.be.equal(0),o.classList.add("active"),simulateEvent("click",0,o),expect(t).to.be.equal(1),n.parentNode.removeChild(n)}),it("Add and remove event handler",function(){var e=new Jodit.modules.EventsNative,t=0,n=document.createElement("button");document.body.appendChild(n),e.on(n,"click",function(){t++}),simulateEvent("click",0,n),expect(t).to.be.equal(1),e.off(n,"click"),simulateEvent("click",0,n),expect(t).to.be.equal(1),n.parentNode.removeChild(n)}),it("Add a few handlers for several evens and remove all handlers",function(){var e=new Jodit.modules.EventsNative,t=0,n=document.createElement("button");document.body.appendChild(n),e.on(n,"click",function(){t++}),e.on(n,"dblclick",function(){t++}),e.on(n,"mousedown",function(){t++}),simulateEvent("click",0,n),simulateEvent("dblclick",0,n),simulateEvent("mousedown",0,n),expect(t).to.be.equal(3),e.off(n),simulateEvent("click",0,n),simulateEvent("dblclick",0,n),simulateEvent("mousedown",0,n),expect(t).to.be.equal(3),n.parentNode.removeChild(n)}),it("Add event handler for several elements",function(){var e=new Jodit(appendTestArea()),t=new Jodit.modules.EventsNative,n="",o=e.editorDocument.createElement("button"),i=e.editorDocument.createElement("button");e.editorDocument.body.appendChild(o),e.editorDocument.body.appendChild(i),o.innerText="test1",i.innerText="test2",t.on([o,i],"click",function(){n+=this.innerText}),t.fire(o,"click"),t.fire(i,"click"),expect(n).to.be.equal("test1test2"),o.parentNode.removeChild(o),i.parentNode.removeChild(i)}),it("Fire trigger",function(){var e=new Jodit.modules.EventsNative,t=0,n=document.createElement("button");document.body.appendChild(n),e.on(n,"click",function(){t++}),e.fire(n,"click"),expect(t).to.be.equal(1),n.parentNode.removeChild(n)}),describe("Add handler like live jQuery method",function(){it("Should work for all feature elements",function(){var e=new Jodit.modules.EventsNative,t=0,n=document.createElement("div");e.on(n,"click",function(){t++},"img"),document.body.appendChild(n),e.fire(n,"click"),expect(t).to.be.equal(0),n.appendChild(document.createElement("a")),e.fire(n.querySelector("a"),"click"),expect(t).to.be.equal(0),n.querySelector("a").appendChild(document.createElement("img")),e.fire(n.querySelector("img"),"click"),expect(t).to.be.equal(1),simulateEvent("click",0,n.querySelector("img")),expect(t).to.be.equal(2),n.parentNode.removeChild(n)})}),describe("Remove handler",function(){it("should remove full handler with selector options",function(){var e=new Jodit.modules.EventsNative,t=0,n=document.createElement("a"),o=document.createElement("button");n.innerText="test",o.appendChild(n),document.body.appendChild(o),e.on(o,"click",function(){t++},"a"),e.fire(o,"click"),expect(t).to.be.equal(0),e.fire(n,"click"),expect(t).to.be.equal(1),e.off(o,"click"),e.fire(n,"click"),expect(t).to.be.equal(1),e.on(o,"click",function(){t++},"a"),e.fire(n,"click"),expect(t).to.be.equal(2),o.parentNode.removeChild(o)})}),describe("Remove all handlers using event namespace",function(){it("Should remove all handlers in this namespace",function(){var e=new Jodit.modules.EventsNative,t=0,n=document.createElement("button");document.body.appendChild(n),e.on(n,"click.test",function(){t++}),e.on(n,"mousedown.test",function(){t++}),e.fire(n,"click"),e.fire(n,"mousedown"),e.fire(n,"click.test"),e.fire(n,"mousedown.test"),expect(t).to.be.equal(4),e.off(n,".test"),e.fire(n,"click"),e.fire(n,"mousedown"),e.fire(n,"click.test"),e.fire(n,"mousedown.test"),expect(t).to.be.equal(4),n.parentNode.removeChild(n)})}),it("Proxy event from iframe.window to main.window",function(){var e=new Jodit.modules.EventsNative,t=0,n=function(){t++};window.addEventListener("mousedown",n),e.fire(window,"mousedown"),expect(t).to.be.equal(1),window.removeEventListener("mousedown",n)})}),describe("Check destruct",function(){describe("For window",function(){it("Should remove all handlers",function(){var e=new Jodit(appendTestArea()),t=0;e.events.on(window,"updateSome1",function(){t+=1}),e.events.fire(window,"updateSome1"),expect(1).to.be.equal(t),simulateEvent("updateSome1",0,window),expect(2).to.be.equal(t),e.destruct(),simulateEvent("updateSome1",0,window),simulateEvent("updateSome1",0,window),simulateEvent("updateSome1",0,window),expect(2).to.be.equal(t)})}),describe("For document",function(){it("Should remove all handlers",function(){var e=new Jodit(appendTestArea()),t=0;e.events.on(document,"updateSome1",function(){t+=1}),e.events.fire(document,"updateSome1"),expect(1).to.be.equal(t),simulateEvent("updateSome1",0,document),expect(2).to.be.equal(t),e.destruct(),simulateEvent("updateSome1",0,document),simulateEvent("updateSome1",0,document),simulateEvent("updateSome1",0,document),expect(2).to.be.equal(t)})}),describe("For body",function(){it("Should remove all handlers",function(){var e=new Jodit(appendTestArea()),t=0;e.events.on(document.body,"updateSome1",function(){t+=1}),e.events.fire(document.body,"updateSome1"),expect(1).to.be.equal(t),simulateEvent("updateSome1",0,document.body),expect(2).to.be.equal(t),e.destruct(),simulateEvent("updateSome1",0,document.body),simulateEvent("updateSome1",0,document.body),simulateEvent("updateSome1",0,document.body),expect(2).to.be.equal(t)})})})}),describe("Helpers",function(){describe("dataBind",function(){it("Should save value in object",function(){var e={stop:2};Jodit.modules.Helpers.dataBind(e,"test",1),expect(Object.keys(e).toString()).to.be.equal("stop"),expect(Jodit.modules.Helpers.dataBind(e,"test")).to.be.equal(1)}),describe("remove value",function(){it("Should save value in object",function(){var e={stop:2};Jodit.modules.Helpers.dataBind(e,"test",1),expect(Object.keys(e).toString()).to.be.equal("stop"),expect(Jodit.modules.Helpers.dataBind(e,"test")).to.be.equal(1),Jodit.modules.Helpers.dataBind(e,"test",2),expect(Jodit.modules.Helpers.dataBind(e,"test")).to.be.equal(2),Jodit.modules.Helpers.dataBind(e,"test",null),expect(Jodit.modules.Helpers.dataBind(e,"test")).to.be.not.equal(2)})})})}),describe("Check case sensitive",function(){it("Should call event listener only when match case",function(){var e=new Jodit.modules.EventsNative,t={},n="";e.on(t,"click",function(e){n+=e}),e.on(t,"CLICK",function(e){n+=e}),e.fire(t,"Click","1"),e.fire(t,"CLICK","2"),e.fire(t,"click","3"),expect("23").to.be.equal(n)})}),afterEach(removeStuff)});