describe("Test plugins",function(){getBox().style.width="auto",describe("Copy format plugin",function(){it("Should copy fontWeight from element and paste it in new selection",function(){getBox().style.width="auto";var e=new Jodit(appendTestArea());e.setEditorValue("text <strong>test</strong> post"),e.selection.setCursorIn(e.editor.querySelector("strong")),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat").length).to.equal(1),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat.jodit_active").length).to.equal(0),simulateEvent("mousedown",0,e.container.querySelector(".jodit_toolbar_btn-copyformat")),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat.jodit_active").length).to.equal(1);var t=e.editorWindow.getSelection(),o=e.editorDocument.createRange();o.selectNode(e.editor.lastChild),t.removeAllRanges(),t.addRange(o),simulateEvent("mouseup",0,e.editor),expect(e.getEditorValue().replace("700","bold")).to.equal('text <strong>test</strong><span style="font-weight: bold;"> post</span>')}),it("Should copy fontSize from element and paste it in new selection",function(){getBox().style.width="auto";var e=new Jodit(appendTestArea());e.setEditorValue('text <span style="font-size: 11px;">test</span> post'),e.selection.setCursorIn(e.editor.querySelector("span")),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat").length).to.equal(1),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat.jodit_active").length).to.equal(0),simulateEvent("mousedown",0,e.container.querySelector(".jodit_toolbar_btn-copyformat")),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat.jodit_active").length).to.equal(1);var t=e.editorWindow.getSelection(),o=e.editorDocument.createRange();o.selectNode(e.editor.lastChild),t.removeAllRanges(),t.addRange(o),simulateEvent("mouseup",0,e.editor),expect(e.getEditorValue()).to.equal('text <span style="font-size: 11px;">test</span><span style="font-size: 11px;"> post</span>')}),describe("Test",function(){it("Should copy fontSize and color from element and paste it in new selection",function(){getBox().style.width="auto";var e=new Jodit(appendTestArea());e.setEditorValue('text <span style="font-size: 11px;color: rgb(255, 0, 0);">test</span> post'),e.selection.setCursorIn(e.editor.querySelector("span")),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat").length).to.equal(1),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat.jodit_active").length).to.equal(0),simulateEvent("mousedown",0,e.container.querySelector(".jodit_toolbar_btn-copyformat")),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat.jodit_active").length).to.equal(1);var t=e.editorWindow.getSelection(),o=e.editorDocument.createRange();o.selectNode(e.editor.lastChild),t.removeAllRanges(),t.addRange(o),simulateEvent("mouseup",0,e.editor),expect(sortAtrtibutes(e.getEditorValue())).to.equal('text <span style="color:#FF0000;font-size:11px">test</span><span style="color:#FF0000;font-size:11px"> post</span>')})}),it("Should toggle active state after double click",function(){getBox().style.width="auto";var e=new Jodit(appendTestArea());e.setEditorValue('text <span style="font-size: 11px;color: rgb(255, 0, 0);">test</span> post'),e.selection.setCursorIn(e.editor.querySelector("span")),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat").length).to.equal(1),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat.jodit_active").length).to.equal(0),simulateEvent("mousedown",0,e.container.querySelector(".jodit_toolbar_btn-copyformat")),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat.jodit_active").length).to.equal(1),simulateEvent("mousedown",0,e.container.querySelector(".jodit_toolbar_btn-copyformat")),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat.jodit_active").length).to.equal(0);var t=e.editorWindow.getSelection(),o=e.editorDocument.createRange();o.selectNode(e.editor.lastChild),t.removeAllRanges(),t.addRange(o),simulateEvent("mouseup",0,e.editor),expect(sortAtrtibutes(e.getEditorValue())).to.equal('text <span style="color:#FF0000;font-size:11px">test</span> post')}),describe("For image",function(){it("Should copy format from one image to another",function(){getBox().style.width="auto";var e=new Jodit(appendTestArea()),t='<img src="tests/artio.jpg" style="height: 100px;width: 100px; margin: 20px; border-image: none; border:1px solid #CCCCCC; border-radius: 50%;"> test <img style="height: 100px;width: 100px;" src="tests/artio.jpg">';e.value=t,expect(sortAtrtibutes(e.value)).to.be.equal(sortAtrtibutes(t)),simulateEvent("mousedown",0,e.editor.querySelector("img")),simulateEvent("mousedown",0,e.container.querySelector(".jodit_toolbar_btn-copyformat")),simulateEvent("mousedown",0,e.editor.querySelectorAll("img")[1]),simulateEvent("mouseup",0,e.editor.querySelectorAll("img")[1]),expect(sortAtrtibutes(e.value)).to.be.equal(sortAtrtibutes('<img src="tests/artio.jpg" style="border-image:none;border-radius:50%;border:1px solid #CCCCCC;height:100px;margin:20px;width:100px"> test <img src="tests/artio.jpg" style="border-image:none;border-color:#CCCCCC;border-radius:50%;border-style:solid;border-width:1px;height:100px;margin:20px;width:100px">'))})}),describe("Set cursor inside em[style=background] > strong elements",function(){it("Should copy fontWeight from strong element, copy italic and background  style from em  and paste it in new selection",function(){getBox().style.width="auto";var e=new Jodit(appendTestArea());e.setEditorValue('text <em style="background-color: #ff0000"><strong>test</strong></em> post'),e.selection.setCursorIn(e.editor.querySelector("strong")),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat").length).to.equal(1),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat.jodit_active").length).to.equal(0),simulateEvent("mousedown",0,e.container.querySelector(".jodit_toolbar_btn-copyformat")),expect(e.container.querySelectorAll(".jodit_toolbar_btn-copyformat.jodit_active").length).to.equal(1);var t=e.editorWindow.getSelection(),o=e.editorDocument.createRange();o.selectNode(e.editor.lastChild),t.removeAllRanges(),t.addRange(o),simulateEvent("mouseup",0,e.editor),expect(sortAtrtibutes(e.getEditorValue().replace(/700/g,"bold").replace(/rgb\(255, 0, 0\)/g,"#ff0000"))).to.equal('text <em style="background-color:#ff0000"><strong>test</strong></em><span style="background-color:#ff0000;font-style:italic;font-weight:bold"> post</span>')})})}),describe("Add new Line plugin",function(){it("Should add new line element in container",function(){var e=new Jodit(appendTestArea());expect(e.container.querySelectorAll(".jodit-add-new-line").length).to.equal(1)}),it("Should show .jodit-add-new-line after user move mouse under Table,Ifrmae or IMG ",function(){var e=new Jodit(appendTestArea());e.setEditorValue("<table><tr><td>1</td></tr><tr><td>2</td></tr><tr><td>3</td></tr><tr><td>4</td></tr></table>"),window.scrollTo(0,e.helper.offset(e.editor,e,e.ownerDocument).top),simulateEvent("mousemove",0,e.editor,function(t){var o=e.helper.offset(e.editor.firstChild,e,e.editorDocument);t.pageX=o.left+5,t.pageY=o.top+5});var t=e.container.querySelector(".jodit-add-new-line");expect(t).not.to.equal(null),expect(e.ownerWindow.getComputedStyle(t).display).to.equal("block")}),it("Should add new paragraph after user clicked on newline ",function(){var e=new Jodit(appendTestArea());e.setEditorValue("<table><tbody><tr><td>2</td></tr><tr><td>2</td></tr><tr><td>3</td></tr><tr><td>4</td></tr></tbody></table>"),window.scrollTo(0,e.helper.offset(e.editor,e,e.ownerDocument).top),simulateEvent("mousemove",0,e.editor,function(t){var o=e.helper.offset(e.editor.firstChild,e,e.editorDocument);t.pageX=o.left+5,t.pageY=o.top+5});var t=e.container.querySelector(".jodit-add-new-line");expect(t).not.to.equal(null),expect(e.ownerWindow.getComputedStyle(t).display).to.equal("block"),simulateEvent("mousedown",0,t.querySelector("span")),expect(e.getElementValue()).to.equal("<p></p><table><tbody><tr><td>2</td></tr><tr><td>2</td></tr><tr><td>3</td></tr><tr><td>4</td></tr></tbody></table>")}),it("Should add new paragraph after user clicked on newline below table",function(){var e=new Jodit(appendTestArea());e.setEditorValue("<table><tbody><tr><td>3</td></tr><tr><td>2</td></tr></tbody></table>"),window.scrollTo(0,e.helper.offset(e.editor,e,e.ownerDocument).top),simulateEvent("mousemove",0,e.editor,function(t){var o=e.helper.offset(e.editor.firstChild,e,e.editorDocument);t.pageX=o.left+5,t.pageY=o.top+(o.height-5)});var t=e.container.querySelector(".jodit-add-new-line");expect(t).not.to.equal(null),expect(e.ownerWindow.getComputedStyle(t).display).to.equal("block"),simulateEvent("mousedown",0,t.querySelector("span")),expect(e.getElementValue()).to.equal("<table><tbody><tr><td>3</td></tr><tr><td>2</td></tr></tbody></table><p></p>")}),it("Should add new paragraph after user clicked on newline below table in IFRAME mode",function(){var e=new Jodit(appendTestArea(),{ifarme:!0});e.setEditorValue("<table><tbody><tr><td>3</td></tr><tr><td>2</td></tr></tbody></table>"),window.scrollTo(0,e.helper.offset(e.editor,e,e.ownerDocument).top),simulateEvent("mousemove",0,e.editor,function(t){var o=e.helper.offset(e.editor.firstChild,e,e.editorDocument);t.pageX=o.left+5,t.pageY=o.top+(o.height-5)});var t=e.container.querySelector(".jodit-add-new-line");expect(t).not.to.equal(null),expect(e.ownerWindow.getComputedStyle(t).display).to.equal("block"),simulateEvent("mousedown",0,t.querySelector("span")),expect(e.getElementValue()).to.equal("<table><tbody><tr><td>3</td></tr><tr><td>2</td></tr></tbody></table><p></p>")}),describe("Insert line on top of IMG element that was inside P element",function(){it("Should insert new P before parent P element",function(){var e=new Jodit(appendTestArea());e.setEditorValue('<p><img src="tests/artio.jpg" style="width: 100px; height: 100px;" alt=""></p>'),window.scrollTo(0,e.helper.offset(e.editor,e,e.ownerDocument).top);var t=e.editor.querySelector("img");expect(null).to.be.not.equal(t),simulateEvent("mousemove",0,e.editor,function(o){var i=e.helper.offset(t,e,e.editorDocument);o.pageX=i.left+5,o.pageY=i.top+5});var o=e.container.querySelector(".jodit-add-new-line");expect(null).to.be.not.equal(o),expect(o.style.display).to.equal("block"),simulateEvent("mousedown",0,o.querySelector("span")),e.selection.insertHTML("stop"),expect('<p>stop</p><p><img alt="" src="tests/artio.jpg" style="height:100px;width:100px"></p>').to.be.equal(sortAtrtibutes(e.getEditorValue()))})})}),describe("Edit image tests",function(){describe("Image editor",function(){describe("Crop mode",function(){describe("Enable ratio",function(){it("Should deny crop image without ratio",function(e){var t=appendTestArea(),o=new Jodit(t,{observer:{timeout:0},uploader:{url:"https://xdsoft.net/jodit/connector/index.php?action=upload"},filebrowser:{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}},disablePlugins:"mobile"});o.setEditorValue('<img src="tests/artio.jpg">'),simulateEvent("dblclick",0,o.editor.querySelector("img"));var i=o.ownerDocument.querySelector("[data-editor_id="+t.id+"].jodit.jodit_dialog_box.active");expect(i.style.display).to.be.not.equal("none"),expect(i.querySelectorAll("a.jodit_use_image_editor").length).to.equal(1),o.events.on("afterImageEditor",function(){var i=o.ownerDocument.querySelector("[data-editor_id="+t.id+"].jodit.jodit_dialog_box.active .jodit_image_editor");expect(i).to.be.not.equal(null),expect(i.querySelectorAll("[data-area=crop]").length).to.equal(1),expect(i.querySelectorAll("[data-area=crop].active").length).to.equal(0),simulateEvent("click",0,i.querySelector("[data-area=crop] > div")),expect(i.querySelectorAll("[data-area=crop].active").length).to.equal(1);var n=i.querySelector(".jodit_image_editor_croper");expect(n).not.to.equal(null);var a=n.offsetWidth/n.offsetHeight;simulateEvent("mousedown",0,n.querySelector(".jodit_bottomright"),function(e){var t=o.helper.offset(n,o,o.ownerDocument);e.clientX=t.left+t.width,e.clientY=t.top+t.height}),simulateEvent("mousemove",0,o.ownerWindow,function(e){var t=o.helper.offset(n,o,o.ownerDocument);e.clientX=t.left+t.width-50,e.clientY=t.top+t.height-150}),simulateEvent("mouseup",0,o.ownerWindow,function(e){var t=o.helper.offset(n,o,o.ownerDocument);e.clientX=t.left+t.width-50,e.clientY=t.top+t.height-150}),expect(Math.abs(n.offsetWidth/n.offsetHeight-a)<.02).to.be.equal(!0),e()}),simulateEvent("mousedown",0,i.querySelector("a.jodit_use_image_editor"))}).timeout(7e3)}),describe("Disable ratio",function(){it("Should allow crop image without ratio",function(e){var t=appendTestArea(),o=new Jodit(t,{observer:{timeout:0},uploader:{url:"https://xdsoft.net/jodit/connector/index.php?action=upload"},filebrowser:{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}}});o.setEditorValue('<img src="tests/artio.jpg">'),simulateEvent("dblclick",0,o.editor.querySelector("img"));var i=o.ownerDocument.querySelector("[data-editor_id="+t.id+"].jodit.jodit_dialog_box.active");expect(i.style.display).to.be.not.equal("none"),expect(i.querySelectorAll("a.jodit_use_image_editor").length).to.equal(1),o.events.on("afterImageEditor",function(){var i=o.ownerDocument.querySelector("[data-editor_id="+t.id+"].jodit.jodit_dialog_box.active .jodit_image_editor");expect(i).to.be.not.equal(null),expect(i.querySelectorAll("[data-area=crop]").length).to.equal(1),expect(i.querySelectorAll("[data-area=crop].active").length).to.equal(0),simulateEvent("click",0,i.querySelector("[data-area=crop] > div")),expect(i.querySelectorAll("[data-area=crop].active").length).to.equal(1);var n=i.querySelector(".jodit_image_editor_croper");expect(n).not.to.equal(null);var a=n.offsetWidth/n.offsetHeight,r=i.querySelector("[data-area=crop].active").querySelector(".jodit_btn_radio_group button:last-child");expect(r).not.to.equal(null),simulateEvent("click",0,r),simulateEvent("mousedown",0,n.querySelector(".jodit_bottomright"),function(e){var t=o.helper.offset(n,o,o.ownerDocument);e.clientX=t.left+t.width,e.clientY=t.top+t.height}),simulateEvent("mousemove",0,o.ownerWindow,function(e){var t=o.helper.offset(n,o,o.ownerDocument);e.clientX=t.left+t.width-50,e.clientY=t.top+t.height-150}),simulateEvent("mouseup",0,o.ownerWindow,function(e){var t=o.helper.offset(n,o,o.ownerDocument);e.clientX=t.left+t.width-50,e.clientY=t.top+t.height-150}),expect(Math.abs(n.offsetWidth/n.offsetHeight-a)>1).to.be.equal(!0),e()}),simulateEvent("mousedown",0,i.querySelector("a.jodit_use_image_editor"))}).timeout(7e3)})}),describe("Resize mode",function(){describe("Enable ratio",function(){it("Should deny resize image without ratio",function(e){var t=appendTestArea(),o=new Jodit(t,{observer:{timeout:0},uploader:{url:"https://xdsoft.net/jodit/connector/index.php?action=upload"},filebrowser:{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}}});o.setEditorValue('<img src="tests/artio.jpg">'),simulateEvent("dblclick",0,o.editor.querySelector("img"));var i=o.ownerDocument.querySelector("[data-editor_id="+t.id+"].jodit.jodit_dialog_box.active");expect(i.style.display).to.be.not.equal("none"),expect(i.querySelectorAll("a.jodit_use_image_editor").length).to.equal(1),o.events.on("afterImageEditor",function(){var i=o.ownerDocument.querySelector("[data-editor_id="+t.id+"].jodit.jodit_dialog_box.active .jodit_image_editor");expect(i).to.be.not.equal(null),expect(i.querySelectorAll("[data-area=resize]").length).to.equal(1),expect(i.querySelectorAll("[data-area=resize].active").length).to.equal(1),simulateEvent("click",0,i.querySelector("[data-area=resize] > div")),expect(i.querySelectorAll("[data-area=resize].active").length).to.equal(1);var n=i.querySelector(".jodit_image_editor_resizer");expect(n).not.to.equal(null);var a=n.offsetWidth/n.offsetHeight;simulateEvent("mousedown",0,n.querySelector(".jodit_bottomright"),function(e){var t=o.helper.offset(n,o,o.ownerDocument);e.clientX=t.left+t.width,e.clientY=t.top+t.height}),simulateEvent("mousemove",0,o.ownerWindow,function(e){var t=o.helper.offset(n,o,o.ownerDocument);e.clientX=t.left+t.width-250,e.clientY=t.top+t.height-150}),simulateEvent("mouseup",0,o.ownerWindow,function(e){var t=o.helper.offset(n,o,o.ownerDocument);e.clientX=t.left+t.width-250,e.clientY=t.top+t.height-150}),expect(Math.abs(n.offsetWidth/n.offsetHeight-a)<.05).to.be.equal(!0),e()}),simulateEvent("mousedown",0,i.querySelector("a.jodit_use_image_editor"))}).timeout(7e3)}),describe("Disable ratio",function(){it("Should allow resize image without ratio",function(e){var t=appendTestArea(),o=new Jodit(t,{observer:{timeout:0},uploader:{url:"https://xdsoft.net/jodit/connector/index.php?action=upload"},filebrowser:{ajax:{url:"https://xdsoft.net/jodit/connector/index.php"}}});o.setEditorValue('<img src="tests/artio.jpg">'),simulateEvent("dblclick",0,o.editor.querySelector("img"));var i=o.ownerDocument.querySelector("[data-editor_id="+t.id+"].jodit.jodit_dialog_box.active");expect(i.style.display).to.be.not.equal("none"),expect(i.querySelectorAll("a.jodit_use_image_editor").length).to.equal(1),o.events.on("afterImageEditor",function(){var i=o.ownerDocument.querySelector("[data-editor_id="+t.id+"].jodit.jodit_dialog_box.active .jodit_image_editor");expect(i).to.be.not.equal(null),expect(i.querySelectorAll("[data-area=resize]").length).to.equal(1),expect(i.querySelectorAll("[data-area=resize].active").length).to.equal(1),simulateEvent("click",0,i.querySelector("[data-area=resize] > div")),expect(i.querySelectorAll("[data-area=resize].active").length).to.equal(1);var n=i.querySelector("[data-area=resize].active").querySelector(".jodit_btn_radio_group button:last-child");expect(n).not.to.equal(null),simulateEvent("click",0,n);var a=i.querySelector(".jodit_image_editor_resizer");expect(a).not.to.equal(null);var r=a.offsetWidth/a.offsetHeight;simulateEvent("mousedown",0,a.querySelector(".jodit_bottomright"),function(e){var t=o.helper.offset(a,o,o.ownerDocument);e.clientX=t.left+t.width,e.clientY=t.top+t.height}),simulateEvent("mousemove",0,o.ownerWindow,function(e){var t=o.helper.offset(a,o,o.ownerDocument);e.clientX=t.left+t.width-50,e.clientY=t.top+t.height-150}),simulateEvent("mouseup",0,o.ownerWindow,function(e){var t=o.helper.offset(a,o,o.ownerDocument);e.clientX=t.left+t.width-50,e.clientY=t.top+t.height-150}),expect(Math.abs(a.offsetWidth/a.offsetHeight-r)>1).to.be.equal(!0),e()}),simulateEvent("mousedown",0,i.querySelector("a.jodit_use_image_editor"))}).timeout(7e3)})})})}),describe("Search plugin",function(){describe("CTRL + F",function(){it("Should show search form and query field must have focus",function(){var e=new Jodit(appendTestArea(),{observer:{timeout:0}}),t=e.container.querySelector(".jodit_search");expect(!1).to.equal(t.classList.contains("jodit_search-active")),simulateEvent("keydown",Jodit.KEY_F,e.editor,function(e){e.ctrlKey=!0}),expect(!0).to.equal(t.classList.contains("jodit_search-active")),expect(!0).to.equal(e.ownerDocument.activeElement===t.querySelector(".jodit_search-query"))})}),describe("CTRL + H",function(){it("Should show search and replace form and query field must have focus",function(){var e=new Jodit(appendTestArea(),{observer:{timeout:0}}),t=e.container.querySelector(".jodit_search");expect(!1).to.equal(t.classList.contains("jodit_search-active")),simulateEvent("keydown",Jodit.KEY_H,e.editor,function(e){e.ctrlKey=!0}),expect(!0).to.equal(t.classList.contains("jodit_search-active")),expect(!0).to.equal(t.classList.contains("jodit_search-and-replace")),expect(!0).to.equal(e.ownerDocument.activeElement===t.querySelector(".jodit_search-query"))}),describe("Press Replace button",function(){it("Should replace value form query field to value from replace field in editor",function(){var e=new Jodit(appendTestArea(),{observer:{timeout:0}});e.setEditorValue("test test test");var t=e.container.querySelector(".jodit_search");expect(!1).to.equal(t.classList.contains("jodit_search-active")),simulateEvent("keydown",Jodit.KEY_H,e.editor,function(e){e.ctrlKey=!0}),expect(!0).to.be.equal(t.classList.contains("jodit_search-active")),expect(!0).to.be.equal(t.classList.contains("jodit_search-and-replace")),expect(!0).to.be.equal(e.ownerDocument.activeElement===t.querySelector(".jodit_search-query"));var o=t.querySelector(".jodit_search-query"),i=t.querySelector(".jodit_search-replace"),n=t.querySelector(".jodit_search_buttons-replace");o.value="t",i.value="w",simulateEvent("click",0,n),simulateEvent("click",0,n),simulateEvent("click",0,n),simulateEvent("click",0,n),expect("wesw wesw test").to.be.equal(e.getEditorValue())})})}),describe("F3 after search",function(){it("Should find a next match",function(){var e=new Jodit(appendTestArea(),{observer:{timeout:0}});e.setEditorValue("test test test");var t=e.editorDocument.createRange();t.setStart(e.editor.firstChild,0),t.setEnd(e.editor.firstChild,4),e.selection.selectRange(t);var o=e.container.querySelector(".jodit_search");expect(!1).to.equal(o.classList.contains("jodit_search-active")),simulateEvent("keydown",Jodit.KEY_F,e.editor,function(e){e.ctrlKey=!0}),expect(!0).to.equal(o.classList.contains("jodit_search-active")),expect(!0).to.equal(e.ownerDocument.activeElement===o.querySelector(".jodit_search-query")),e.selection.removeMarkers(),Jodit.modules.Helpers.normalizeNode(e.editor.firstChild),e.events.fire("searchNext"),simulateEvent("keydown",Jodit.KEY_F3,e.editor,function(e){e.shiftKey=!1});var i=e.editorWindow.getSelection();expect(1).to.equal(i.rangeCount),t=i.getRangeAt(0),expect(e.editor.firstChild).to.equal(t.startContainer),expect(5).to.equal(t.startOffset),expect(e.editor.firstChild).to.equal(t.endContainer),expect(9).to.equal(t.endOffset)}),it("Should find the next match in a circle",function(){var e=new Jodit(appendTestArea(),{observer:{timeout:0}});e.setEditorValue("test test test");var t=e.editorDocument.createRange();t.setStart(e.editor.firstChild,0),t.setEnd(e.editor.firstChild,1),e.selection.selectRange(t);var o=e.container.querySelector(".jodit_search");expect(!1).to.equal(o.classList.contains("jodit_search-active")),simulateEvent("keydown",Jodit.KEY_F,e.editor,function(e){e.ctrlKey=!0}),expect(!0).to.equal(o.classList.contains("jodit_search-active")),expect(!0).to.equal(e.ownerDocument.activeElement===o.querySelector(".jodit_search-query")),e.selection.removeMarkers(),Jodit.modules.Helpers.normalizeNode(e.editor.firstChild);var i=e.editorWindow.getSelection();e.events.fire("searchNext"),[[3,4],[5,6],[8,9],[10,11],[13,14],[0,1],[3,4]].forEach(function(o){simulateEvent("keydown",Jodit.KEY_F3,e.editor,function(e){e.shiftKey=!1}),expect(1).to.equal(i.rangeCount),t=i.getRangeAt(0),expect(o[0]).to.equal(t.startOffset),expect(o[1]).to.equal(t.endOffset)})}),describe("with SHIFT key",function(){it("Should find a previous match",function(){var e=new Jodit(appendTestArea(),{observer:{timeout:0}});e.setEditorValue("test test test");var t=e.editorDocument.createRange();t.setStart(e.editor.firstChild,0),t.setEnd(e.editor.firstChild,4),e.selection.selectRange(t);var o=e.container.querySelector(".jodit_search");expect(!1).to.equal(o.classList.contains("jodit_search-active")),simulateEvent("keydown",Jodit.KEY_F,e.editor,function(e){e.ctrlKey=!0}),expect(!0).to.equal(o.classList.contains("jodit_search-active")),expect(!0).to.equal(e.ownerDocument.activeElement===o.querySelector(".jodit_search-query")),e.selection.removeMarkers(),Jodit.modules.Helpers.normalizeNode(e.editor.firstChild),e.events.fire("searchNext"),simulateEvent("keydown",Jodit.KEY_F3,e.editor,function(e){e.shiftKey=!0});var i=e.editorWindow.getSelection();expect(1).to.equal(i.rangeCount),t=i.getRangeAt(0),expect(e.editor.firstChild).to.equal(t.startContainer),expect(10).to.equal(t.startOffset),expect(e.editor.firstChild).to.equal(t.endContainer),expect(14).to.equal(t.endOffset)})})}),describe("Esc in query field",function(){it("Should hide search form and restore selection",function(){var e=new Jodit(appendTestArea(),{observer:{timeout:0}});e.setEditorValue("<p>text</p>");var t=e.editorDocument.createRange();t.setStart(e.editor.firstChild.firstChild,1),t.setEnd(e.editor.firstChild.firstChild,3);var o=e.editorWindow.getSelection();o.removeAllRanges(),o.addRange(t);var i=e.container.querySelector(".jodit_search");expect(!1).to.equal(i.classList.contains("jodit_search-active")),simulateEvent("keydown",Jodit.KEY_F,e.editor,function(e){e.ctrlKey=!0}),expect(!0).to.equal(i.classList.contains("jodit_search-active")),expect(!0).to.equal(e.ownerDocument.activeElement===i.querySelector(".jodit_search-query")),simulateEvent("keydown",27,i.querySelector(".jodit_search-query")),expect(!1).to.equal(i.classList.contains("jodit_search-active")),expect("ex").to.equal(o.toString())})}),describe("Unit test compare string",function(){describe("Get index of found string",function(){it("Should find needle in haystack",function(){var e="Mr John Smith washed window";expect(11).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("th was",e)),expect(11).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("TH WAS",e)),expect(!1).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("TH WASNT",e))}),it("Should find needle in haystack steb by step",function(){expect(!1).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("th was","Mr")),expect(!1).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("th was","Mr John")),expect(11).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("th was","Mr John Smith")),expect(11).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("th was","Mr John Smith wa")),expect(!1).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("th was","Mr John Smith s")),expect(11).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("th was","Mr John Smith washed")),expect(11).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("th was","Mr John Smith washed window"))}),it("Should find needle in haystack steb by step in back direction",function(){expect(!1).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("th was","window",!1)),expect(0).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("th was","washed window",!1)),expect(0).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("th was","h washed window",!1)),expect(3).to.be.equal(Jodit.plugins.search.getSomePartOfStringIndex("th was","Smith washed window",!1))})}),describe("Compare strings and return boolean",function(){it("Should find needle in haystack",function(){var e="Mr John Smith washed window";expect(!0).to.be.equal(Jodit.plugins.search.findSomePartOfString("th was",e)),expect(!0).to.be.equal(Jodit.plugins.search.findSomePartOfString("TH WAS",e)),expect(!0).to.be.equal(Jodit.plugins.search.findSomePartOfString("TH  WAS",e)),expect(!1).to.be.equal(Jodit.plugins.search.findSomePartOfString("TH WASNT",e))}),it("Should find needle in haystack steb by step",function(){expect(!1).to.be.equal(Jodit.plugins.search.findSomePartOfString("th was","Mr")),expect(!1).to.be.equal(Jodit.plugins.search.findSomePartOfString("th was","Mr John")),expect("th").to.be.equal(Jodit.plugins.search.findSomePartOfString("th was","Mr John Smith")),expect("th wa").to.be.equal(Jodit.plugins.search.findSomePartOfString("th was","Mr John Smith wa")),expect("th wa").to.be.equal(Jodit.plugins.search.findSomePartOfString("th  was","Mr John Smith wa")),expect("th  wa").to.be.equal(Jodit.plugins.search.findSomePartOfString("th was","Mr John Smith  wa")),expect(!1).to.be.equal(Jodit.plugins.search.findSomePartOfString("th was","Mr John Smith s")),expect(!0).to.be.equal(Jodit.plugins.search.findSomePartOfString("th was","Mr John Smith washed")),expect(!0).to.be.equal(Jodit.plugins.search.findSomePartOfString("th  was","Mr John Smith washed")),expect(!0).to.be.equal(Jodit.plugins.search.findSomePartOfString("th was","Mr John Smith washed window"))}),it("Should find needle in haystack steb by step in back direction",function(){expect(!1).to.be.equal(Jodit.plugins.search.findSomePartOfString("th was","window",!1)),expect("was").to.be.equal(Jodit.plugins.search.findSomePartOfString("th was","washed window",!1)),expect("h was").to.be.equal(Jodit.plugins.search.findSomePartOfString("th was","h washed window",!1)),expect(!0).to.be.equal(Jodit.plugins.search.findSomePartOfString("th was","Smith washed window",!1))})}),describe("Haystack less needle",function(){it("Should return false",function(){expect(!1).to.be.equal(Jodit.plugins.search.findSomePartOfString("th was"," ",!0)),expect(!1).to.be.equal(Jodit.plugins.search.findSomePartOfString("Smith washed window","washed",!0))})})}),describe("Fire search event",function(){it("Should select some elements which consists query string",function(){var e=new Jodit(appendTestArea(),{observer:{timeout:0}});e.setEditorValue("<p><span>Mr</span> <span>John</span> <span>Smith</span> <span>washed</span> <span>window</span></p>");var t=e.editorWindow.getSelection();t.removeAllRanges(),e.events.fire("search","th was"),expect(1).to.be.equal(t.rangeCount);var o=t.getRangeAt(0);expect(e.editor.firstChild.childNodes[4].firstChild).to.be.equal(o.startContainer),expect(3).to.be.equal(o.startOffset),expect(e.editor.firstChild.childNodes[6].firstChild).to.be.equal(o.endContainer),expect(3).to.be.equal(o.startOffset)})})}),describe("Indent plugin",function(){describe("Check i18n tooltip",function(){describe("Native tooltip",function(){it("Should have different tooltip for each language",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarAdaptive:!1,useNativeTooltip:!0,buttons:"indent,outdent",language:"en"});expect(null).to.be.not.equal(t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-outdent [title]"));var o=t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-outdent [title]").getAttribute("title");t.destruct();t=new Jodit(e,{toolbarAdaptive:!1,useNativeTooltip:!0,buttons:"indent,outdent",language:"ru"});expect(null).to.be.not.equal(t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-outdent [title]")),expect(o).to.be.not.equal(t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-outdent [title]").getAttribute("title"))})}),describe("Jodits tooltip",function(){it("Should have different tooltip for each language",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarAdaptive:!1,useNativeTooltip:!1,buttons:"indent,outdent",showTooltipDelay:0,language:"en"}),o=t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-outdent");expect(null).to.be.not.equal(o),simulateEvent("mouseenter",0,o.querySelector("a"));var i=o.querySelector(".jodit_tooltip");expect(null).to.be.not.equal(i);var n=i.innerText;t.destruct(),o=(t=new Jodit(e,{toolbarAdaptive:!1,useNativeTooltip:!1,showTooltipDelay:0,buttons:"indent,outdent",language:"ru"})).container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-outdent"),expect(null).to.be.not.equal(o),simulateEvent("mouseenter",0,o.querySelector("a")),i=o.querySelector(".jodit_tooltip"),expect(null).to.be.not.equal(i),simulateEvent("mouseleave",0,o.querySelector("a")),expect(null).to.be.equal(i.parentNode),expect(n).to.be.not.equal(i.innerText)})})}),it("Should set active outdent button if current container has marginLeft",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarAdaptive:!1,buttons:"indent,outdent"});t.setEditorValue("<p>text</p>"),t.selection.setCursorIn(t.editor.firstChild.firstChild),simulateEvent("mousedown",0,t.editor.firstChild),expect(null).to.be.not.equal(t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-outdent.jodit_disabled")),t.editor.firstChild.style.marginLeft="100px",simulateEvent("mousedown",0,t.editor.firstChild),expect(null).to.be.equal(t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-outdent.jodit_disabled"))}),describe("Press Indent button",function(){it("Should increase indent for current blocks",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarAdaptive:!1,buttons:"indent,outdent",indentMargin:5});t.setEditorValue("<h1>test</h1><p>text</p><p>text</p>");var o=t.editorDocument.createRange();o.setStartBefore(t.editor.firstChild),o.setEndAfter(t.editor.firstChild.nextSibling),t.selection.selectRange(o),simulateEvent("mousedown",0,t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-indent")),simulateEvent("mousedown",0,t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-indent")),simulateEvent("mousedown",0,t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-indent")),expect('<h1 style="margin-left: 15px;">test</h1><p style="margin-left: 15px;">text</p><p>text</p>').to.be.equal(t.getEditorValue()),simulateEvent("mousedown",0,t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-outdent")),
simulateEvent("mousedown",0,t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-outdent")),simulateEvent("mousedown",0,t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-outdent")),expect("<h1>test</h1><p>text</p><p>text</p>").to.be.equal(t.getEditorValue())})}),describe("Run indent command for inline elements",function(){it("should wrap elements in block and change margin for it",function(){var e=appendTestArea(),t=new Jodit(e);t.value="a<br>b<br>c<br>",t.selection.setCursorAfter(t.editor.lastChild),t.execCommand("indent"),expect('<p style="margin-left: 10px;">a<br>b<br>c<br></p>').to.be.equal(t.value)})})}),describe("Symbols plugin",function(){it("Should create symbol button in toolbar and after click open dialog with symbols",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarAdaptive:!1,buttons:"symbol"});t.setEditorValue("test");var o=t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-symbol");expect(null).to.be.not.equal(o),simulateEvent("mousedown",0,o);var i=t.ownerDocument.querySelector(".jodit_dialog_box.active.jodit_modal .jodit_dialog_content .jodit_symbols");expect(null).to.be.not.equal(i)}),describe("Symbols dialog",function(){it("Should have focus on first element after open",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarAdaptive:!1,buttons:"symbol"});t.setEditorValue("test");var o=t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-symbol");expect(null).to.be.not.equal(o),simulateEvent("mousedown",0,o);var i=t.ownerDocument.querySelector(".jodit_dialog_box.active.jodit_modal .jodit_dialog_content .jodit_symbols");expect(null).to.be.not.equal(i),expect(i.querySelector("a")).to.be.equal(t.ownerDocument.activeElement)}),describe("Press key left",function(){it("Should select previous element",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarAdaptive:!1,buttons:"symbol"});t.setEditorValue("test");var o=t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-symbol");expect(null).to.be.not.equal(o),simulateEvent("mousedown",0,o);var i=t.ownerDocument.querySelector(".jodit_dialog_box.active.jodit_modal .jodit_dialog_content .jodit_symbols");expect(null).to.be.not.equal(i);var n=i.getElementsByTagName("a")[10];simulateEvent("keydown",Jodit.KEY_LEFT,n,function(e){e.target=n}),expect(t.ownerDocument.activeElement).to.be.equal(i.getElementsByTagName("a")[9])})}),describe("Press key right",function(){it("Should select next element",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarAdaptive:!1,buttons:"symbol"});t.setEditorValue("test");var o=t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-symbol");expect(null).to.be.not.equal(o),simulateEvent("mousedown",0,o);var i=t.ownerDocument.querySelector(".jodit_dialog_box.active.jodit_modal .jodit_dialog_content .jodit_symbols");expect(null).to.be.not.equal(i);var n=i.getElementsByTagName("a")[10];simulateEvent("keydown",Jodit.KEY_RIGHT,n,function(e){e.target=n}),expect(t.ownerDocument.activeElement).to.be.equal(i.getElementsByTagName("a")[11])})}),describe("Press key top",function(){it("Should select element above",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarAdaptive:!1,buttons:"symbol"});t.setEditorValue("test");var o=t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-symbol");expect(null).to.be.not.equal(o),simulateEvent("mousedown",0,o);var i=t.ownerDocument.querySelector(".jodit_dialog_box.active.jodit_modal .jodit_dialog_content .jodit_symbols");expect(null).to.be.not.equal(i);var n=i.getElementsByTagName("a")[30];simulateEvent("keydown",Jodit.KEY_UP,n,function(e){e.target=n}),expect(t.ownerDocument.activeElement).to.be.equal(i.getElementsByTagName("a")[13]),n=i.getElementsByTagName("a")[10],simulateEvent("keydown",Jodit.KEY_UP,n,function(e){e.target=n}),expect(t.ownerDocument.activeElement).to.be.equal(i.getElementsByTagName("a")[197])})}),describe("Press key bottom",function(){it("Should select element below",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarAdaptive:!1,buttons:"symbol"});t.setEditorValue("test");var o=t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-symbol");expect(null).to.be.not.equal(o),simulateEvent("mousedown",0,o);var i=t.ownerDocument.querySelector(".jodit_dialog_box.active.jodit_modal .jodit_dialog_content .jodit_symbols");expect(null).to.be.not.equal(i);var n=i.getElementsByTagName("a")[30];simulateEvent("keydown",Jodit.KEY_DOWN,n,function(e){e.target=n}),expect(t.ownerDocument.activeElement).to.be.equal(i.getElementsByTagName("a")[47]),n=i.getElementsByTagName("a")[200],simulateEvent("keydown",Jodit.KEY_DOWN,n,function(e){e.target=n}),expect(t.ownerDocument.activeElement).to.be.equal(i.getElementsByTagName("a")[13])})}),describe("Press Enter or mousdown on element",function(){it("Should insert character",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarAdaptive:!1,buttons:"symbol"});t.setEditorValue("");var o=t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-symbol");expect(null).to.be.not.equal(o),simulateEvent("mousedown",0,o);var i=t.ownerDocument.querySelector(".jodit_dialog_box.active.jodit_modal .jodit_dialog_content .jodit_symbols");expect(null).to.be.not.equal(i);var n=i.getElementsByTagName("a")[5];simulateEvent("keydown",Jodit.KEY_ENTER,n),expect("&amp;").to.be.equal(t.getEditorValue()),simulateEvent("mousedown",0,o),i=t.ownerDocument.querySelector(".jodit_dialog_box.active.jodit_modal .jodit_dialog_content .jodit_symbols"),expect(null).to.be.not.equal(i);n=i.getElementsByTagName("a")[125];simulateEvent("mousedown",0,n),expect("&amp;\xbd").to.be.equal(t.getEditorValue())})})}),describe("Symbols popup",function(){it("Should create popup this symbols",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarAdaptive:!1,buttons:"symbol",usePopupForSpecialCharacters:!0});t.setEditorValue("test");var o=t.editorDocument.createRange();o.setStart(t.editor.firstChild,0),o.collapse(!0),t.selection.selectRange(o);var i=t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-symbol");expect(null).to.be.not.equal(i),simulateEvent("mousedown",0,i);var n=t.ownerDocument.querySelector(".jodit_dialog_box.active.jodit_modal .jodit_dialog_content .jodit_symbols");expect(null).to.be.equal(n);var a=t.container.querySelector(".jodit_toolbar_popup");expect(null).to.be.not.equal(a),expect("block").to.be.equal(window.getComputedStyle(a).display);var r=a.getElementsByTagName("a")[125];simulateEvent("mousedown",0,r),expect("\xbdtest").to.be.equal(t.getEditorValue()),expect(null).to.be.equal(a.parentNode)})})}),describe("Hotkeys",function(){describe("Override default shortcuts for some commands",function(){it("Should work default shortcuts for another commands",function(){var e=appendTestArea(),t=new Jodit(e,{commandToHotkeys:{bold:"ctrl+shift+b",italic:["ctrl+i","ctrl+shift+i"]}});t.setEditorValue("test test test");var o=t.editorDocument.createRange();o.setStart(t.editor.firstChild,4),o.setEnd(t.editor.firstChild,8),t.selection.selectRange(o),simulateEvent("keydown",85,t.editor,function(e){e.ctrlKey=!0}),expect("test<u> tes</u>t test").to.be.equal(t.getEditorValue())}),describe("Replace ctrl+b to ctrl+shift+b for bold command",function(){it("Should not execute bold on ctrl+b",function(){var e=appendTestArea(),t=new Jodit(e,{commandToHotkeys:{bold:"ctrl+shift+b",italic:["ctrl+i","ctrl+shift+i"]}});t.setEditorValue("test test test");var o=t.editorDocument.createRange();o.setStart(t.editor.firstChild,4),o.setEnd(t.editor.firstChild,8),t.selection.selectRange(o),simulateEvent("keydown",66,t.editor,function(e){e.ctrlKey=!0}),expect("test test test").to.be.equal(t.getEditorValue()),simulateEvent("keydown",66,t.editor,function(e){e.shiftKey=!0,e.ctrlKey=!0}),expect("test<strong> tes</strong>t test").to.be.equal(t.getEditorValue())}),it("Should execute bold on ctrl+shift+b",function(){var e=appendTestArea(),t=new Jodit(e,{commandToHotkeys:{bold:"ctrl+shift+b",italic:["ctrl+i","ctrl+shift+i"]}});t.setEditorValue("test test test");var o=t.editorDocument.createRange();o.setStart(t.editor.firstChild,4),o.setEnd(t.editor.firstChild,8),t.selection.selectRange(o),simulateEvent("keydown",66,t.editor,function(e){e.shiftKey=!0,e.ctrlKey=!0}),expect("test<strong> tes</strong>t test").to.be.equal(t.getEditorValue())})}),describe("Add ctrl+shift+i to default ctrl+i shortcut for italic command",function(){it("Should work with each of shortcuts",function(){var e,t=appendTestArea(),o=new Jodit(t,{commandToHotkeys:{bold:"ctrl+shift+b",italic:["ctrl+i","ctrl+shift+i"]}});o.value="test test test",(e=o.editorDocument.createRange()).setStart(o.editor.firstChild,4),e.setEnd(o.editor.firstChild,8),o.selection.selectRange(e),simulateEvent("keydown",73,o.editor,function(e){e.ctrlKey=!0}),expect("test<em> tes</em>t test").to.be.equal(o.value),o.value="test test test",(e=o.editorDocument.createRange()).setStart(o.editor.firstChild,4),e.setEnd(o.editor.firstChild,8),o.selection.selectRange(e),simulateEvent("keydown",73,o.editor,function(e){e.shiftKey=!0,e.ctrlKey=!0}),expect("test<em> tes</em>t test").to.be.equal(o.value),simulateEvent("keydown",103,o.editor,function(e){e.shiftKey=!0,e.ctrlKey=!0}),expect("<ol><li>test<em> tes</em>t test</li></ol>").to.be.equal(o.value.replace("<br>",""))})})})}),describe("Sticky plugin",function(){describe("Without scrolling",function(){it("Should not have `jodit_sticky` class and toolbar must be in normal state",function(){var e=appendTestArea(),t=new Jodit(e);t.setEditorValue("<p>stop</p>".repeat(100)),expect(!1).to.be.equal(t.container.classList.contains("jodit_sticky"))})}),describe("Create editor in page with long text",function(){describe("and scroll page to bottom",function(){it("Should add to editor class `jodit_sticky` and toolbar must be always on the top",function(){var e=appendTestArea(),t=new Jodit(e);t.setEditorValue("<p>stop</p>".repeat(100));var o=Jodit.modules.Helpers.offset(t.container,t,t.ownerDocument);window.scroll(0,o.top+o.height/2),simulateEvent("scroll",0,window),expect(!0).to.be.equal(t.container.classList.contains("jodit_sticky")),expect(0).to.be.equal(t.toolbar.container.getBoundingClientRect().top)}),describe("On mobile devices - with toolbarDisableStickyForMobile = true",function(){it("Should not add to editor class `jodit_sticky`",function(){getBox().style.width="370px";var e=appendTestArea(),t=new Jodit(e);t.setEditorValue("<p>stop</p>".repeat(100));var o=Jodit.modules.Helpers.offset(t.container,t,t.ownerDocument);window.scroll(0,o.top+o.height/2),simulateEvent("scroll",0,window),expect(!1).to.be.equal(t.container.classList.contains("jodit_sticky")),expect(0).to.be.not.equal(t.toolbar.container.getBoundingClientRect().top),getBox().style.width="auto"})}),describe("In iframe mode",function(){it("Should work some way",function(){var e=new Jodit(appendTestArea(),{iframe:!0});e.setEditorValue("<p>stop</p>".repeat(100));var t=Jodit.modules.Helpers.offset(e.container,e,e.ownerDocument);window.scroll(0,t.top+t.height/2),simulateEvent("scroll",0,window),expect(!0).to.be.equal(e.container.classList.contains("jodit_sticky")),expect(0).to.be.equal(e.toolbar.container.getBoundingClientRect().top)})}),describe("add offset for toolbar",function(){it("Should add offset for sticky toolbar",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarStickyOffset:100});t.setEditorValue("<p>stop</p>".repeat(100));var o=Jodit.modules.Helpers.offset(t.container,t,t.ownerDocument);window.scroll(0,o.top+o.height/2),simulateEvent("scroll",0,window),expect(!0).to.be.equal(t.container.classList.contains("jodit_sticky")),expect(100).to.be.equal(t.toolbar.container.getBoundingClientRect().top)})}),describe("with toolbarSticky false",function(){it("Should do nothing with toolbar",function(){var e=appendTestArea(),t=new Jodit(e,{toolbarStickyOffset:100,toolbarSticky:!1});t.setEditorValue("<p>stop</p>".repeat(100));var o=Jodit.modules.Helpers.offset(t.container,t,t.ownerDocument);window.scroll(0,o.top+o.height/2),simulateEvent("scroll",0,window),expect(!1).to.be.equal(t.container.classList.contains("jodit_sticky")),expect(100).to.be.not.equal(t.toolbar.container.getBoundingClientRect().top),expect(0).to.be.not.equal(t.toolbar.container.getBoundingClientRect().top)})})}),describe("and scroll page to the top",function(){it("Should remove class `jodit_sticky` from editor and toolbar must have normal position",function(){var e=appendTestArea(),t=new Jodit(e),o=[0,0,0,0,0,0,0,0,0].map(function(){return t.ownerDocument.createElement("br")});o.forEach(function(e){t.container.parentNode.insertBefore(e,t.container)}),t.setEditorValue("<p>stop</p>".repeat(100));var i=Jodit.modules.Helpers.offset(t.container,t,t.ownerDocument);window.scroll(0,i.top-200),simulateEvent("scroll",0,window),expect(!1).to.be.equal(t.container.classList.contains("jodit_sticky")),expect(5).to.be.above(Math.abs(200-t.toolbar.container.getBoundingClientRect().top)),o.forEach(function(e){e.parentNode.removeChild(e)})})})})}),describe("Clean html plugin",function(){describe("Click remove format button",function(){it("Should clear selected HTML fragment",function(){var e=appendTestArea(),t=new Jodit(e);t.setEditorValue('start <span style="background-color: red; color: blue;">test test test</span> elm');var o=t.editorDocument.createRange();o.setStartBefore(t.editor.querySelector("span")),o.setEndAfter(t.editor.querySelector("span")),t.selection.selectRange(o);var i=t.container.querySelector(".jodit_toolbar_btn.jodit_toolbar_btn-eraser");expect(null).to.be.not.equal(i),simulateEvent("mousedown",0,i),expect("start test test test elm").to.be.equal(t.getEditorValue().replace("<span>","").replace("</span>",""))})}),describe("Replace old tags",function(){it("Should replace old tags to new",function(){var e=new Jodit(appendTestArea(),{cleanHTML:{timeout:0}});e.value="test <b>old</b> test";var t=e.editorDocument.createRange();t.setStart(e.editor.querySelector("b").firstChild,2),t.collapse(!0),e.selection.selectRange(t),simulateEvent("mousedown",0,e.editor),e.selection.insertHTML(" some "),expect(e.value).to.be.equal("test <strong>ol some d</strong> test")}),describe("Replace custom tags",function(){it("Should replace tags",function(){var e=new Jodit(appendTestArea(),{cleanHTML:{replaceOldTags:{p:"div"},timeout:0}});e.value="<p>test <b>old</b> test</p>";var t=e.editorDocument.createRange();t.setStart(e.editor.querySelector("b").firstChild,2),t.collapse(!0),e.selection.selectRange(t),simulateEvent("mousedown",0,e.editor),e.selection.insertHTML(" some "),expect(e.value).to.be.equal("<div>test <strong>ol some d</strong> test</div>")})}),describe("Disable",function(){it("Should not replace old tags to new",function(){var e=new Jodit(appendTestArea(),{cleanHTML:{replaceOldTags:!1,timeout:0}});e.value="test <b>old</b> test";var t=e.editorDocument.createRange();t.setStart(e.editor.querySelector("b").firstChild,2),t.collapse(!0),e.selection.selectRange(t),simulateEvent("mousedown",0,e.editor),e.selection.insertHTML(" some "),expect(e.value).to.be.equal("test <b>ol some d</b> test")})})}),describe("Deny tags",function(){describe("Parameter like string",function(){it("Should remove all tags in denyTags options",function(){var e=new Jodit(appendTestArea(),{cleanHTML:{denyTags:"p"}});e.value="<p>te<strong>stop</strong>st</p><h1>pop</h1>",expect(e.value).to.be.equal("<h1>pop</h1>")})})}),describe("Allow tags",function(){describe("Parameter like string",function(){it("Should remove all tags not in allowTags options",function(){var e=new Jodit(appendTestArea(),{cleanHTML:{allowTags:"p"}});e.value="<p>te<strong>stop</strong>st</p><h1>pop</h1>",expect(e.value).to.be.equal("<p>test</p>")})}),describe("Parameter like hash",function(){it("Should remove all tags not in allowTags options",function(){var e=new Jodit(appendTestArea(),{cleanHTML:{allowTags:{p:!0}}});e.value="<p>te<strong>stop</strong>st</p><h1>pop</h1>",expect(e.value).to.be.equal("<p>test</p>")})}),describe("Allow attributes",function(){it("Should remove all attributes from element and remove not in allowTags options",function(){var e=new Jodit(appendTestArea(),{cleanHTML:{allowTags:{p:{style:!0}}}});e.value='<p style="color: red;" data-id="111">te<strong>stop</strong>st</p><h1>pop</h1>',expect(e.value).to.be.equal('<p style="color: red;">test</p>')})}),describe("Time checking",function(){it("Should work fast",function(){var e=new Jodit(appendTestArea(),{cleanHTML:{allowTags:{p:{style:!0}}}});e.value='<p style="color: red;" data-id="111">te<strong>stop</strong>st</p><h1>pop</h1>'.repeat(500),expect(e.value).to.be.equal('<p style="color: red;">test</p>'.repeat(500))}).timeout(1500)})}),describe("Fullfill empty paragraph",function(){it("Should fill in empty paragraph",function(){var e=new Jodit(appendTestArea(),{cleanHTML:{fillEmptyParagraph:!0}});e.value="<p></p><p></p><div></div>",expect(e.value).to.be.equal("<p><br></p><p><br></p><div><br></div>")}),describe("Switch off fillEmptyParagraph option",function(){it("Should not fill in empty paragraph",function(){var e=new Jodit(appendTestArea(),{cleanHTML:{fillEmptyParagraph:!1}});e.value="<p></p><p></p><div></div>",expect(e.value).to.be.equal("<p></p><p></p><div></div>")})})})}),describe("Size plugin",function(){describe("In iframe mode after change mode",function(){it("Should set min-height to iframe",function(){var e=new Jodit(appendTestArea(),{iframe:!0,minHeight:300});e.setEditorValue(""),e.toggleMode(),e.toggleMode(),expect(e.editor.offsetHeight).to.be.above(200)})}),describe("Set height",function(){it("Should set container height",function(){var e=new Jodit(appendTestArea(),{height:222});expect(e.container.offsetHeight).to.be.equal(222)})})}),describe("Fullsize plugin",function(){describe("Toggle fullsize",function(){it("Should resize all boxes to first state",function(){var e=new Jodit(appendTestArea(),{observer:{timeout:0}}),t=["container","workplace","editor"],o=t.map(function(t){return e[t].offsetHeight}),i=function(e,t){return Math.abs(e-t)<=2};e.toggleFullSize(!0),t.map(function(t,n){expect(i(e[t].offsetHeight,o[n])).to.be["false"]}),e.toggleFullSize(!1),t.map(function(t,n){expect(i(e[t].offsetHeight,o[n])).to.be["true"]})})})}),describe("Stat plugin",function(){describe("After init and change",function(){it("Should show chars count and words count",function(){var e=new Jodit(appendTestArea(),{language:"en",showCharsCounter:!0,showWordsCounter:!0,observer:{timeout:0}});e.value="<p>Simple text</p>";var t=e.container.querySelector(".jodit_statusbar");expect(t).to.be.not.equal(null),expect(t.innerText.match(/Chars: 10/)).to.be.not.equal(null),expect(t.innerText.match(/Words: 2/)).to.be.not.equal(null)}),describe("Hide chars count",function(){it("Should show only words count",function(){var e=new Jodit(appendTestArea(),{language:"en",showCharsCounter:!1,showWordsCounter:!0,observer:{timeout:0}});e.value="<p>Simple text</p>";var t=e.container.querySelector(".jodit_statusbar");expect(t).to.be.not.equal(null),expect(t.innerText.match(/Chars: 10/)).to.be.equal(null),expect(t.innerText.match(/Words: 2/)).to.be.not.equal(null)})}),describe("Hide words count",function(){it("Should show only chars count",function(){var e=new Jodit(appendTestArea(),{language:"en",showCharsCounter:!0,showWordsCounter:!1,observer:{timeout:0}});e.value="<p>Simple text</p>";var t=e.container.querySelector(".jodit_statusbar");expect(t).to.be.not.equal(null),expect(t.innerText.match(/Chars: 10/)).to.be.not.equal(null),expect(t.innerText.match(/Words: 2/)).to.be.equal(null)})}),describe("Hide words and chars count",function(){it("Should hide status bar",function(){var e=new Jodit(appendTestArea(),{language:"en",showCharsCounter:!1,showWordsCounter:!1,showXPathInStatusbar:!1,observer:{timeout:0}});e.value="<p>Simple text</p>";var t=e.container.querySelector(".jodit_statusbar");expect(t).to.be.not.equal(null),expect(t.innerText.match(/Chars: 10/)).to.be.equal(null),expect(t.innerText.match(/Words: 2/)).to.be.equal(null),expect(t.offsetHeight).to.be.equal(0)})})})}),describe("Path plugin",function(){describe("After init",function(){describe("With showXPathInStatusbar=true",function(){it("Should show status bar",function(){var e=new Jodit(appendTestArea(),{language:"en",showXPathInStatusbar:!0,showCharsCounter:!1,showWordsCounter:!1,observer:{timeout:0}});e.value="<p>Simple text</p>";var t=e.container.querySelector(".jodit_statusbar");expect(e.ownerWindow.getComputedStyle(t).display).to.be.equal("block")}),it("Should show path to selection element",function(){var e=new Jodit(appendTestArea(),{language:"en",showXPathInStatusbar:!0,observer:{timeout:0}});e.value='<p>Simple text <a href="#">sss</a></p>',e.selection.setCursorIn(e.editor.querySelector("a"));var t=e.container.querySelector(".jodit_statusbar ul");expect(t).to.be.not.equal(null),expect(t.firstChild.innerText).to.be.equal(""),expect(t.childNodes[1].innerText).to.be.equal("p"),expect(t.childNodes[2].innerText).to.be.equal("a")}),describe("After change selection",function(){it("Should change path to selection element",function(){var e=new Jodit(appendTestArea(),{language:"en",showXPathInStatusbar:!0,observer:{timeout:0}});e.value='<p>Simple text <a href="#">sss</a><span>s</span></p>',e.selection.setCursorIn(e.editor.querySelector("a"));var t=e.container.querySelector(".jodit_statusbar ul");expect(t).to.be.not.equal(null),expect(t.firstChild.innerText).to.be.equal(""),expect(t.childNodes[1].innerText).to.be.equal("p"),expect(t.childNodes[2].innerText).to.be.equal("a"),e.selection.setCursorIn(e.editor.querySelector("span")),expect(t.firstChild.innerText).to.be.equal(""),expect(t.childNodes[1].innerText).to.be.equal("p"),expect(t.childNodes[2].innerText).to.be.equal("span")})}),describe("After click on element of path",function(){it("Should select this element",function(){var e=new Jodit(appendTestArea(),{language:"en",showXPathInStatusbar:!0,observer:{timeout:0}});e.value='<p>Simple text <a href="#">sss</a><span>s</span></p>',e.selection.setCursorIn(e.editor.querySelector("a"));var t=e.container.querySelector(".jodit_statusbar ul");expect(t).to.be.not.equal(null),expect(t.firstChild.innerText).to.be.equal(""),expect(t.childNodes[1].innerText).to.be.equal("p"),expect(t.childNodes[2].innerText).to.be.equal("a"),simulateEvent("click",0,t.childNodes[2].firstChild),expect(e.helper.trim(e.editorWindow.getSelection().toString())).to.be.equal("sss"),expect(t.childNodes[2].innerText).to.be.equal("a"),simulateEvent("click",0,t.childNodes[1].firstChild),expect(e.helper.trim(e.editorWindow.getSelection().toString())).to.be.equal("Simple text ssss"),expect(t.childNodes.length).to.be.equal(3)})}),describe("Context menu on element of path",function(){it("Should open context menu",function(){var e=new Jodit(appendTestArea(),{language:"en",showXPathInStatusbar:!0,observer:{timeout:0}});e.value='<p>Simple text <a href="#">sss</a><span>s</span></p>',e.selection.setCursorIn(e.editor.querySelector("a"));var t=e.container.querySelector(".jodit_statusbar ul");expect(t).to.be.not.equal(null),expect(t.firstChild.innerText).to.be.equal(""),expect(t.childNodes[1].innerText).to.be.equal("p"),expect(t.childNodes[2].innerText).to.be.equal("a"),simulateEvent("contextmenu",0,t.childNodes[2].firstChild);var o=e.ownerDocument.querySelector(".jodit_context_menu[data-editor_id="+e.id+"]");expect(o).to.be.not.equal(null),expect(e.ownerWindow.getComputedStyle(o).display).to.be.equal("block"),simulateEvent("click",0,o.querySelector("a")),expect(e.value).to.be.equal("<p>Simple text <span>s</span></p>"),expect(e.ownerWindow.getComputedStyle(o).display).to.be.equal("none")})})})})}),describe("Paste storage",function(){describe("Empty list",function(){it("Sholud not show dialog",function(){var e=new Jodit(appendTestArea());simulateEvent("keydown",Jodit.KEY_V,e.editor,function(e){e.ctrlKey=!0,e.shiftKey=!0});var t=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor="+e.id+"]");expect(t).to.be.equal(null)})}),describe("After copy elements",function(){it("Sholud show dialog with pasted list",function(){var e=new Jodit(appendTestArea(),{observer:{timeout:0}});e.selection.focus(),e.value="abcde";var t=e.ownerDocument.createRange();t.setStart(e.editor.firstChild,0),t.setEnd(e.editor.firstChild,1),e.selection.selectRange(t),simulateEvent("copy",0,e.editor,function(e){Object.defineProperty(e,"clipboardData",{value:{getData:function(){},setData:function(){}}})}),t.setStart(e.editor.firstChild,1),t.setEnd(e.editor.firstChild,2),e.selection.selectRange(t),simulateEvent("copy",0,e.editor,function(e){Object.defineProperty(e,"clipboardData",{value:{getData:function(){},setData:function(){}}})}),simulateEvent("keydown",Jodit.KEY_V,e.editor,function(e){e.ctrlKey=!0,e.shiftKey=!0});var o=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");expect(o).to.be.not.equal(null)}),describe("After click on some of elements",function(){it("Sholud select this",function(){var e=new Jodit(appendTestArea());e.value="abcde";var t=e.ownerDocument.createRange();t.setStart(e.editor.firstChild,0),t.setEnd(e.editor.firstChild,1),e.selection.selectRange(t),simulateEvent("copy",0,e.editor,function(e){Object.defineProperty(e,"clipboardData",{value:{getData:function(){},setData:function(){}}})}),t.setStart(e.editor.firstChild,1),t.setEnd(e.editor.firstChild,2),e.selection.selectRange(t),simulateEvent("copy",0,e.editor,function(e){Object.defineProperty(e,"clipboardData",{value:{getData:function(){},setData:function(){}}})}),simulateEvent("keydown",Jodit.KEY_V,e.editor,function(e){e.ctrlKey=!0,e.shiftKey=!0});var o=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");expect(o).to.be.not.equal(null),simulateEvent("click",0,o.querySelectorAll(".jodit_paste_storage a")[1]),expect(o.querySelectorAll(".jodit_paste_storage a")[1].classList.contains("jodit_active")).to.be.equal(!0),simulateEvent("dblclick",0,o.querySelectorAll(".jodit_paste_storage a")[1]),expect(e.ownerWindow.getComputedStyle(o).display).to.be.equal("none"),expect(e.value).to.be.equal("aacde")})}),describe("Press key up/down/enter",function(){it("Sholud select next/previos element of list and insert selected value after Enter",function(){var e=new Jodit(appendTestArea());e.value="abcde";var t=e.ownerDocument.createRange();t.setStart(e.editor.firstChild,0),t.setEnd(e.editor.firstChild,1),e.selection.selectRange(t),simulateEvent("copy",0,e.editor,function(e){Object.defineProperty(e,"clipboardData",{value:{getData:function(){},setData:function(){}}})}),t.setStart(e.editor.firstChild,1),t.setEnd(e.editor.firstChild,2),e.selection.selectRange(t),simulateEvent("copy",0,e.editor,function(e){Object.defineProperty(e,"clipboardData",{value:{getData:function(){},setData:function(){}}})}),simulateEvent("keydown",Jodit.KEY_V,e.editor,function(e){e.ctrlKey=!0,e.shiftKey=!0});var o=e.ownerDocument.querySelector(".jodit.jodit_dialog_box.active[data-editor_id="+e.id+"]");expect(o).to.be.not.equal(null),simulateEvent("click",0,o.querySelectorAll(".jodit_paste_storage a")[0]),expect(o.querySelectorAll(".jodit_paste_storage a")[0].classList.contains("jodit_active")).to.be.equal(!0),simulateEvent("keydown",Jodit.KEY_UP,o.querySelectorAll(".jodit_paste_storage a")[0]),expect(o.querySelectorAll(".jodit_paste_storage a")[1].classList.contains("jodit_active")).to.be.equal(!0),simulateEvent("keydown",Jodit.KEY_UP,o.querySelectorAll(".jodit_paste_storage a")[1]),expect(o.querySelectorAll(".jodit_paste_storage a")[0].classList.contains("jodit_active")).to.be.equal(!0),simulateEvent("keydown",Jodit.KEY_DOWN,o.querySelectorAll(".jodit_paste_storage a")[0]),expect(o.querySelectorAll(".jodit_paste_storage a")[1].classList.contains("jodit_active")).to.be.equal(!0),simulateEvent("keydown",Jodit.KEY_ENTER,o.querySelectorAll(".jodit_paste_storage a")[0]),expect(e.ownerWindow.getComputedStyle(o).display).to.be.equal("none"),expect(e.value).to.be.equal("aacde")})})})}),describe("Limit plugin",function(){describe("Keydown",function(){describe("On keydown when editor aleady full",function(){it("should deny insert any chars",function(e){var t=new Jodit(appendTestArea(),{limitChars:5,observer:{timeout:5}});t.value="11111",t.selection.insertHTML("a"),setTimeout(()=>{expect("11111").to.be.equal(t.value),e()},200)})})}),describe("Paste",function(){describe("When editor aleady full",function(){it("should deny insert any chars",function(e){var t=new Jodit(appendTestArea(),{limitChars:5,observer:{timeout:5}});t.value="11111",simulateEvent("paste",0,t.editor,function(e){e.clipboardData={types:["text/html"],getData:function(){return"a"}}}),setTimeout(()=>{expect("11111").to.be.equal(t.value),e()},200)})})}),describe("Limit words",function(){describe("Paste",function(){describe("When editor aleady full",function(){it("should deny insert any chars",function(e){var t=new Jodit(appendTestArea(),{limitWords:3,observer:{timeout:5}});t.value="11111",t.selection.setCursorAfter(t.editor.firstChild);const o=()=>{simulateEvent("paste",0,t.editor,function(e){e.clipboardData={types:["text/html"],getData:function(){return" aaa"}}})},i=()=>{setTimeout(()=>{expect("11111 aaa aaa").to.be.equal(t.value),e()},200)};o(),expect("11111 aaa").to.be.equal(t.value),o(),expect("11111 aaa aaa").to.be.equal(t.value),o(),i()})})})})}),afterEach(removeStuff)});